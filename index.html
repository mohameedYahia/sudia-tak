<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨ÙˆØ§Ø¨Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.16/mammoth.browser.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f8f9fa;
        }
        /* Login Page styles */
        .login-bg { 
            background-color: #f8f9fa;
            position: relative;
            overflow: hidden;
        }

        .login-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('https://placehold.co/400x200/4A5C52/FFFFFF?text=Ø´Ø¹Ø§Ø±');
            background-repeat: no-repeat;
            background-position: center;
            background-size: 50%;
            opacity: 0.5;
            z-index: 1.5;
        }
       
        .login-card {
            background-color: rgba(74, 92, 82, 0.9);
            backdrop-filter: blur(4px);
            position: relative;
            z-index: 1;
        }

        .user-type-btn.active {
            background-color: #F2E3B3;
            color: #4A5C52;
            font-weight: bold;
        }
       
        /* Portal Page styles */
        :root {
            --olive-dark: #3D4A3A;
            --gold-accent: #DAA520;
            --sidebar-bg: #111827;
            --sidebar-text: #d1d5db;
            --sidebar-hover-bg: #1f2937;
            --sidebar-active-bg: #374151; 
        }
       
        .portal-theme-text { color: var(--olive-dark); }
        .nav-link.active {
            background-color: var(--sidebar-active-bg);
            color: white;
            border-right: 4px solid var(--gold-accent);
        }
        .nav-parent-button.active {
            background-color: var(--sidebar-active-bg);
            color: white;
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 320px;
        }
        .modal-backdrop { 
            transition: opacity 0.3s ease;
            perspective: 1000px;
        }
        .modal-content { 
            transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1), opacity 0.4s ease;
            transform-style: preserve-3d;
        }
        .modal-backdrop.hidden .modal-content {
            opacity: 0;
            transform: scale(0.9) rotateY(15deg);
        }
       
        .sidebar {
            background: linear-gradient(to bottom, #2c3e50, #1a2920);
            transition: transform 0.3s ease-in-out;
        }
        .rotate-180 {
            transform: rotate(180deg);
        }
        .submenu {
            background-color: rgba(0,0,0,0.2);
        }
        .input-method-btn.active {
            border-color: var(--gold-accent);
            color: var(--olive-dark);
            background-color: #fefce8;
        }
        .icon-3d {
             text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }
        .avatar-3d {
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3), 0 4px 6px rgba(0,0,0,0.2);
        }
        .project-accordion-content, .proj-type-accordion-content, .staged-project-accordion-content {
            max-height: 2000px; /* A large value for transition */
            transition: max-height 0.7s ease-in-out, padding 0.5s ease-in-out, opacity 0.3s ease-in-out 0.1s;
            overflow: hidden;
        }
        .project-accordion-content.hidden, .proj-type-accordion-content.hidden, .staged-project-accordion-content.hidden {
            max-height: 0;
            padding-top: 0;
            padding-bottom: 0;
            opacity: 0;
        }

        .step-choice-btn, .functional-card, .nav-link-card {
            transition: all 0.2s ease-in-out;
        }
        .step-choice-btn:hover, .functional-card:hover, .nav-link-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
        }
        .data-table td, .data-table th, .boq-table td, .boq-table th {
            padding: 12px 8px;
            border: 1px solid #ddd;
            text-align: right;
            vertical-align: middle;
            white-space: nowrap;
        }
        .data-table th, .boq-table th {
             white-space: nowrap;
        }
         .boq-template-table td, .boq-template-table th {
            width: auto; /* Let browser decide width */
        }
        .boq-template-table td input {
             min-width: 100px; /* Minimum width for inputs */
        }
        .boq-template-table th:nth-child(4), .boq-template-table td:nth-child(4) {
             white-space: normal; /* Allow scope to wrap */
             min-width: 250px;
        }


        .data-table input, .data-table select, .data-table textarea, .boq-table input {
            width: 100%;
            border: 1px solid #ccc;
            padding: 6px;
            border-radius: 4px;
            background-color: transparent;
            transition: all 0.2s ease;
        }
        .data-table input:focus, .data-table select:focus, .data-table textarea:focus, .boq-table input:focus {
            outline: 1px solid var(--gold-accent);
            background-color: #fefce8;
            border-color: var(--gold-accent);
        }
        .boq-template-table input {
            text-align: right;
        }
        .boq-template-table input.readonly {
            background-color: #f3f4f6;
            cursor: not-allowed;
        }
        @keyframes jiggle {
            0%, 100% { transform: rotate(0); }
            10% { transform: rotate(-10deg); }
            20% { transform: rotate(10deg); }
            30% { transform: rotate(-10deg); }
            40% { transform: rotate(10deg); }
            50% { transform: rotate(0); }
        }
        .jiggle { animation: jiggle 0.6s ease-in-out; }
        mark {
            background-color: #fef08a;
            padding: 0 2px;
            border-radius: 2px;
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        /* Staging Area Styles */
        .staged-project-accordion {
             background-color: white;
             border-radius: 0.75rem;
             box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
             overflow: hidden;
             transition: box-shadow 0.3s ease;
        }
        .staged-project-accordion:hover {
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .staged-project-accordion-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 1rem 1.5rem;
            background-color: #f3f4f6;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .staged-project-accordion-toggle.proposed {
            background-color: #dbeafe; /* blue-100 */
            color: #1e40af; /* blue-800 */
        }
        .staged-project-accordion-toggle.tendered {
            background-color: #dcfce7; /* green-100 */
            color: #15803d; /* green-700 */
        }
        .staged-file-preview {
            font-size: 0.8rem;
            color: #6b7280;
            background: #f3f4f6;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            margin-top: 0.25rem;
            display: inline-block;
        }
        .staged-docs-container {
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
        }
        .progress-bar-inner {
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .progress-bar-inner.bg-blue-600 {
            background-image: linear-gradient(to right, #60a5fa, #3b82f6);
        }
        .progress-bar-inner.bg-green-500 {
            background-image: linear-gradient(to right, #4ade80, #22c55e);
        }
        .rating-stars span {
            cursor: pointer;
            color: #d1d5db; /* gray-400 */
            transition: color 0.2s;
        }
        .rating-stars span:hover,
        .rating-stars span.active {
            color: #f59e0b; /* amber-500 */
        }
        .file-item, .folder-item {
            position: relative;
        }
        .delete-item-btn {
            position: absolute;
            top: 4px;
            left: 4px;
            width: 24px;
            height: 24px;
            background-color: rgba(239, 68, 68, 0.8);
            color: white;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            line-height: 1;
            border: none;
            cursor: pointer;
        }
        .file-item:hover .delete-item-btn, .folder-item:hover .delete-item-btn {
            display: flex;
        }
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
        }
        .status-approved { background-color: #dcfce7; color: #166534; }
        .status-rejected { background-color: #fee2e2; color: #991b1b; }
        .status-pending { background-color: #fef9c3; color: #854d0e; }
    </style>
</head>
<body class="text-gray-800">

    <!-- Login Page -->
    <div id="login-page" class="login-bg min-h-screen flex flex-col items-center justify-center p-4">
        <div class="w-full max-w-md login-card rounded-2xl p-8 shadow-2xl">
            <header class="mb-6">
                <div class="flex justify-between items-center mb-6">
                    <div class="h-16 w-16 bg-white/20 rounded-full flex items-center justify-center">
                         <img src="https://placehold.co/80x80/ffffff/4A5C52?text=Ø´Ø¹Ø§Ø±" alt="Ø´Ø¹Ø§Ø±" class="rounded-full opacity-100">
                    </div>
                    <div class="text-center text-white">
                        <h1 class="text-xl font-bold">ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©</h1>
                        <h2 class="text-2xl font-extrabold">Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ø³Ø¬ÙˆÙ†</h2>
                        <p class="text-sm">Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„ÙÙ†ÙŠØ© - Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª ÙˆØ§Ù„ØªØµØ§Ù…ÙŠÙ…</p>
                    </div>
                    <div class="h-16 w-16 bg-white/20 rounded-full flex items-center justify-center">
                         <img src="https://placehold.co/80x80/ffffff/4A5C52?text=Ø´Ø¹Ø§Ø±" alt="Ø´Ø¹Ø§Ø±" class="rounded-full opacity-100">
                    </div>
                </div>
                 <div class="flex justify-center gap-2 max-w-sm mx-auto">
                    <button class="user-type-btn w-full p-2 rounded-lg bg-white/10 text-white transition" data-user="admin">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
                    <button class="user-type-btn active w-full p-2 rounded-lg bg-white/10 text-white transition" data-user="user">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</button>
                </div>
            </header>
            <main>
                <div class="text-center text-white mb-6">
                    <h3 class="text-2xl font-bold">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
                    <p class="text-sm opacity-80">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø­Ø³Ø§Ø¨Ùƒ</p>
                </div>
                <form id="login-form" class="space-y-5">
                    <div class="relative">
                        <input type="text" id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required class="w-full bg-white/10 text-white placeholder-white/70 p-3 pr-10 rounded-lg border-2 border-transparent focus:border-[#F2E3B3] focus:outline-none transition">
                        <span class="absolute right-3 top-1/2 -translate-y-1/2 text-white/70">ğŸ‘¤</span>
                    </div>
                    <div class="relative">
                        <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required class="w-full bg-white/10 text-white placeholder-white/70 p-3 pr-10 rounded-lg border-2 border-transparent focus:border-[#F2E3B3] focus:outline-none transition">
                         <span class="absolute right-3 top-1/2 -translate-y-1/2 text-white/70">ğŸ”’</span>
                    </div>
                    <div class="flex justify-between items-center text-sm text-white">
                        <div class="flex items-center gap-2">
                            <input type="checkbox" id="remember" class="form-checkbox h-4 w-4 rounded bg-white/30 text-[#F2E3B3] focus:ring-0">
                            <label for="remember">ØªØ°ÙƒØ±Ù†ÙŠ</label>
                        </div>
                        <a href="#" class="hover:underline">Ù‡Ù„ Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±ØŸ</a>
                    </div>
                    <div><button type="submit" class="w-full bg-[#F2E3B3] text-[#4A5C52] font-bold p-3 rounded-lg hover:bg-opacity-90 transition">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button></div>
                </form>
            </main>
        </div>
    </div>
   
    <!-- Main Portal Page -->
    <div id="portal-page" class="hidden">
        <div class="flex h-screen bg-gray-100">
            <!-- Sidebar -->
            <aside id="sidebar" class="sidebar w-64 fixed top-0 right-0 h-full z-30 md:relative md:translate-x-0 transform translate-x-full">
                 <div class="p-4 border-b border-gray-700 text-center flex items-center justify-center gap-2">
                    <img src="https://placehold.co/100x60/ffffff/4A5C52?text=Ø´Ø¹Ø§Ø±" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¤Ø³Ø³Ø©" class="w-25 h-14 rounded-full">
                    <h2 class="text-xl font-bold text-white">ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</h2>
                </div>
                <nav class="mt-4">
                    <p class="px-4 text-xs text-gray-500 uppercase font-semibold">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</p>
                    <a href="#" class="nav-link flex items-center px-4 py-3 mt-2 text-gray-300 hover:bg-gray-700 hover:text-white" data-page="home">
                        <span class="text-xl icon-3d">ğŸ </span><span class="mx-3 font-medium">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
                    </a>
                    <a href="#" class="nav-link flex items-center px-4 py-3 mt-2 text-gray-300 hover:bg-gray-700 hover:text-white" data-page="dashboard">
                        <span class="text-xl icon-3d">ğŸ›ï¸</span><span class="mx-3 font-medium">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
                    </a>
                   
                    <div>
                        <button id="projects-dropdown-toggle" class="nav-parent-button w-full flex items-center justify-between px-4 py-3 mt-2 text-gray-300 hover:bg-gray-700 hover:text-white">
                            <span class="flex items-center">
                                <span class="text-xl icon-3d">ğŸ—ï¸</span>
                                <span class="mx-3 font-medium">Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</span>
                            </span>
                            <svg id="projects-dropdown-arrow" class="w-5 h-5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div id="projects-dropdown-menu" class="hidden pt-2 pr-4 space-y-1">
                             <div>
                                <button id="studies-dropdown-toggle" class="nav-parent-button w-full flex items-center justify-between px-4 py-2 text-gray-300 hover:bg-gray-700 hover:text-white rounded-md">
                                    <span class="flex items-center">
                                        <span class="text-lg icon-3d">ğŸ“</span>
                                        <span class="mx-3 font-medium text-sm">Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ùˆ Ø§Ù„ØªØµØ§Ù…ÙŠÙ…</span>
                                    </span>
                                    <svg id="studies-dropdown-arrow" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                </button>
                                <div id="studies-dropdown-menu" class="hidden pt-2 pr-6 space-y-1 submenu">
                                    <a href="#" class="nav-link block px-3 py-2 text-sm text-gray-400 hover:bg-gray-700 hover:text-white rounded-md" data-page="database-specs-sub">Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ùˆ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª</a>
                                    <a href="#" class="nav-link block px-3 py-2 text-sm text-gray-400 hover:bg-gray-700 hover:text-white rounded-md" data-page="building-models-sub">Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ</a>
                                    <a href="#" class="nav-link block px-3 py-2 text-sm text-gray-400 hover:bg-gray-700 hover:text-white rounded-md" data-page="tendering-sub">Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø´Ø±ÙˆØ¹</a>
                                    <a href="#" class="nav-link block px-3 py-2 text-sm text-gray-400 hover:bg-gray-700 hover:text-white rounded-md" data-page="projects-sub">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</a>
                                </div>
                             </div>
                            <a href="#" class="nav-link flex items-center px-4 py-2 text-gray-300 hover:bg-gray-700 hover:text-white rounded-md" data-page="engineering-supervision">
                               <span class="text-lg icon-3d">ğŸ› ï¸</span><span class="mx-3 font-medium text-sm">Ø§Ù„Ø§Ø´Ø±Ø§Ù Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠ</span>
                            </a>
                        </div>
                    </div>
                   
                    <a href="#" class="nav-link flex items-center px-4 py-3 mt-2 text-gray-300 hover:bg-gray-700 hover:text-white" data-page="entities">
                        <span class="text-xl icon-3d">ğŸ¢</span><span class="mx-3 font-medium">Ø§Ù„Ø¬Ù‡Ø§Øª</span>
                    </a>
                    <a href="#" class="nav-link flex items-center px-4 py-3 mt-2 text-gray-300 hover:bg-gray-700 hover:text-white" data-page="archive">
                        <span class="text-xl icon-3d">ğŸ—„ï¸</span><span class="mx-3 font-medium">Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</span>
                    </a>
                    <a href="#" class="nav-link flex items-center px-4 py-3 mt-2 text-gray-300 hover:bg-gray-700 hover:text-white" data-page="notifications-log">
                        <span class="text-xl icon-3d">ğŸ””</span><span class="mx-3 font-medium">Ø§Ø´Ø¹Ø§Ø±Ø§Øª</span>
                    </a>
                </nav>
            </aside>
           
            <!-- Main Content -->
            <div class="flex-1 flex flex-col overflow-hidden">
                <header class="flex justify-between items-center p-4 bg-white border-b shadow-sm z-20">
                    <div class="flex items-center">
                         <button id="menu-toggle-button" class="md:hidden text-gray-600 focus:outline-none">
                             <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                         </button>
                        <h1 class="text-xl font-semibold text-gray-800 mx-4" id="page-title">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <button id="notification-bell" class="relative text-gray-600 hover:text-gray-800">
                                <span class="text-2xl icon-3d">ğŸ””</span>
                                <span id="notification-indicator" class="hidden absolute top-0 right-0 h-2.5 w-2.5 bg-red-500 rounded-full border-2 border-white"></span>
                            </button>
                            <div id="notifications-dropdown" class="hidden absolute left-0 mt-2 w-80 bg-white rounded-lg shadow-xl overflow-hidden z-20">
                                <div class="py-2 px-4 font-bold border-b">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</div>
                                <div id="notifications-list" class="max-h-64 overflow-y-auto"></div>
                            </div>
                        </div>
                        <div class="avatar-3d w-10 h-10 rounded-full bg-[#B8860B] flex items-center justify-center font-bold text-white border-2 border-white">Ø¹</div>
                    </div>
                </header>
               
                <main id="main-content" class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-4 md:p-8">
                    <!-- Home Page Content -->
                    <div id="home" class="page-content">
                        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6">
                            <div class="xl:col-span-1 bg-white p-6 rounded-xl shadow-lg flex flex-col items-center text-center">
                                <div class="w-24 h-24 rounded-full bg-yellow-100 flex items-center justify-center mb-4 border-4 border-white shadow-md">
                                    <span class="text-5xl" style="color: var(--gold-accent);">ğŸ‘¤</span>
                                </div>
                                <h3 id="home-user-name" class="font-bold text-xl portal-theme-text"></h3>
                                <p id="home-user-role" class="text-sm text-gray-500"></p>
                            </div>
                            <a href="#" data-page="dashboard" class="nav-link-card bg-white p-6 rounded-xl shadow-lg hover:shadow-xl flex items-center gap-4">
                                <span class="text-4xl icon-3d">ğŸ›ï¸</span>
                                <div>
                                    <h3 class="font-bold text-xl portal-theme-text">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
                                    <p class="text-sm text-gray-500">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª ÙˆØ§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©</p>
                                </div>
                            </a>
                             <a href="#" data-page="projects-sub" class="nav-link-card bg-white p-6 rounded-xl shadow-lg hover:shadow-xl flex items-center gap-4">
                                <span class="text-xl icon-3d">ğŸ—ï¸</span>
                                <div>
                                    <h3 class="font-bold text-xl portal-theme-text">Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</h3>
                                    <p class="text-sm text-gray-500">ØªØµÙØ­ ÙˆØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ ÙˆØ§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</p>
                                </div>
                            </a>
                             <a href="#" data-page="archive" class="nav-link-card bg-white p-6 rounded-xl shadow-lg hover:shadow-xl flex items-center gap-4">
                                <span class="text-xl icon-3d">ğŸ—„ï¸</span>
                                <div>
                                    <h3 class="font-bold text-xl portal-theme-text">Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</h3>
                                    <p class="text-sm text-gray-500">Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø¯Ø§Ø¦Ù… Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª</p>
                                </div>
                            </a>
                        </div>
                    </div>

                    <!-- Dashboard Page Content -->
                    <div id="dashboard" class="page-content hidden">
                         <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div class="bg-white p-5 rounded-xl shadow-lg text-center"><p class="text-4xl font-bold" style="color: var(--olive-dark);" id="kpi-total"></p><p class="text-gray-500 mt-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</p></div>
                            <div class="bg-white p-5 rounded-xl shadow-lg text-center"><p class="text-4xl font-bold" style="color: var(--gold-accent);" id="kpi-ongoing"></p><p class="text-gray-500 mt-1">Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø·Ø±Ø­</p></div>
                            <div class="bg-white p-5 rounded-xl shadow-lg text-center"><p class="text-4xl font-bold text-gray-500" id="kpi-previous"></p><p class="text-gray-500 mt-1">Ø³Ø§Ø¨Ù‚Ø©</p></div>
                            <div class="bg-white p-5 rounded-xl shadow-lg text-center"><p class="text-4xl font-bold text-blue-600" id="kpi-proposed"></p><p class="text-gray-500 mt-1">Ù…Ù‚ØªØ±Ø­Ø©</p></div>
                         </div>
                         <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
                            <div class="lg:col-span-3 bg-white p-6 rounded-xl shadow-lg"><h3 class="font-bold text-lg" style="color: var(--olive-dark);">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</h3><div class="chart-container"><canvas id="barChart"></canvas></div></div>
                            <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg">
                                <h3 class="font-bold text-lg mb-4" style="color: var(--olive-dark);">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² ÙÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø·Ø±Ø­</h3>
                                <div id="average-completion-container" class="flex items-center justify-center mb-6">
                                    <!-- Circular progress will be injected here -->
                                </div>
                                <div id="ongoing-projects-summary-container" class="space-y-4">
                                    <!-- Project bars will be injected here -->
                                </div>
                            </div>
                         </div>
                    </div>

                    <!-- Projects Page Content -->
                    <div id="projects-sub" class="page-content hidden">
                       <div id="project-summary-cards" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6"></div>
                       <div id="filtered-project-view" class="hidden">
                             <div class="flex justify-between items-center mb-6">
                                <div class="flex items-center gap-4">
                                     <h2 id="filtered-project-title" class="text-2xl font-bold" style="color: var(--olive-dark);"></h2>
                                </div>
                                <div class="flex items-center gap-2">
                                     <button id="add-category-button" class="bg-blue-600 text-white text-sm rounded-lg px-4 py-2 hover:bg-blue-700 transition-colors flex items-center gap-2"><span>+</span> Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø©</button>
                                     <button id="add-project-button" class="bg-green-600 text-white text-sm rounded-lg px-4 py-2 hover:bg-green-700 transition-colors flex items-center gap-2"><span>+</span> Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹</button>
                                     <button id="back-to-summary" class="bg-gray-800 text-white text-sm rounded-lg px-4 py-2 hover:bg-black transition-colors">â†’ Ø§Ù„Ø±Ø¬ÙˆØ¹</button>
                                </div>
                            </div>
                           
                           <div class="bg-white p-4 rounded-xl shadow-lg mb-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                               <div>
                                   <label for="detail-region-filter" class="block text-sm font-medium text-gray-700">ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
                                   <div class="flex items-center gap-2">
                                       <select id="detail-region-filter" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-yellow-500 focus:border-yellow-500 sm:text-sm rounded-md"></select>
                                       <button id="add-region-button" class="bg-blue-500 text-white rounded-full w-8 h-8 flex-shrink-0 flex items-center justify-center text-lg font-bold hover:bg-blue-600 transition-colors mt-1" title="Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©">+</button>
                                   </div>
                               </div>
                               <div>
                                   <label for="details-search-filter" class="block text-sm font-medium text-gray-700">Ø¨Ø­Ø« Ø´Ø§Ù…Ù„ (Ø§Ø¶ØºØ· Enter Ù„Ù„Ø¨Ø­Ø«)</label>
                                   <input type="text" id="details-search-filter" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ù…Ø´Ø±ÙˆØ¹ Ø£Ùˆ Ù…Ù„Ù..." class="mt-1 focus:ring-yellow-500 focus:border-yellow-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                               </div>
                           </div>
                           <div id="project-details-container" class="mt-6 space-y-4"></div>
                       </div>
                       <div id="document-list-view" class="hidden">
                            <div class="flex justify-between items-center mb-6">
                                <h2 id="document-list-title" class="text-2xl font-bold portal-theme-text"></h2>
                                <button id="back-to-project-details" class="bg-gray-800 text-white text-sm rounded-lg px-4 py-2 hover:bg-black transition-colors">â†’ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</button>
                            </div>
                            <div id="document-list-container" class="bg-white p-4 sm:p-6 rounded-xl shadow-lg"></div>
                       </div>
                    </div>

                    <!-- Tendering Page Content -->
                    <div id="tendering-sub" class="page-content hidden">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold" style="color: var(--olive-dark);">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±</h2>
                            <button id="add-staged-project-btn" class="bg-blue-600 text-white text-sm rounded-lg px-4 py-2 hover:bg-blue-700 transition-colors flex items-center gap-2">
                                <span>+</span> Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ Ù„Ù„ØªØ­Ø¶ÙŠØ±
                            </button>
                        </div>
                        <div id="staged-projects-container" class="space-y-4">
                            <!-- Staged projects will be rendered here by JS -->
                        </div>
                        <div id="no-staged-projects-msg" class="hidden text-center p-10 bg-white rounded-xl shadow">
                            <p class="text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ± Ø­Ø§Ù„ÙŠØ§Ù‹.</p>
                            <p class="text-gray-400 text-sm mt-2">Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ "Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ Ù„Ù„ØªØ­Ø¶ÙŠØ±" Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù„Ù‰ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯.</p>
                        </div>
                    </div>
                    
                    <!-- Karrasa (Specs) Page -->
                    <div id="karrasa-page" class="page-content hidden">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold" style="color: var(--olive-dark);">Ø¥Ø¯Ø§Ø±Ø© ÙƒØ±Ø§Ø³Ø© Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ù…ÙˆØ§ØµÙØ§Øª</h2>
                            <button class="back-to-database-specs bg-gray-800 text-white text-sm rounded-lg px-4 py-2 hover:bg-black transition-colors">â†’ Ø§Ù„Ø±Ø¬ÙˆØ¹</button>
                        </div>
                        <div id="karrasa-list-view">
                           <div class="bg-white p-6 rounded-xl shadow-lg">
                               <div class="flex items-center gap-4 mb-4">
                                   <button id="add-new-karrasa-btn" class="bg-blue-600 text-white text-sm rounded-lg px-4 py-2 hover:bg-blue-700"><span>â•</span> Ø¥Ø¶Ø§ÙØ© ÙƒØ±Ø§Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                               </div>
                               <div id="karrasa-list" class="space-y-3">
                                   </div>
                           </div>
                        </div>
                        <div id="karrasa-editor-view" class="hidden bg-white p-6 rounded-xl shadow-lg">
                            <div>
                                <label for="karrasaName" class="block text-sm font-medium mb-1">Ø§Ø³Ù… Ø§Ù„ÙƒØ±Ø§Ø³Ø©</label>
                                <input type="text" id="karrasaName" placeholder="Ù…Ø«Ø§Ù„: ÙƒØ±Ø§Ø³Ø© Ø´Ø±ÙˆØ· Ù…Ø´Ø±ÙˆØ¹ ØµÙŠØ§Ù†Ø©" class="data-table input w-full mb-4">
                            </div>
                            <div>
                                <label for="karrasaContent" class="block text-sm font-medium mb-1">Ø§Ù„Ù…Ø­ØªÙˆÙ‰</label>
                                <textarea id="karrasaContent" rows="15" class="data-table textarea w-full"></textarea>
                            </div>
                            <div id="karrasa-editor-buttons" class="mt-4 flex justify-between items-center">
                                <div>
                                    <button id="karrasa-import-word" class="bg-teal-600 text-white text-sm rounded-lg px-4 py-2 hover:bg-teal-700 flex items-center gap-2"><span>ğŸ“¤</span> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Word</button>
                                    <button id="karrasa-export-word" class="bg-green-600 text-white text-sm rounded-lg px-4 py-2 hover:bg-green-700 flex items-center gap-2"><span>â¬‡ï¸</span> ØªØ­Ù…ÙŠÙ„ ÙƒÙ€ Word</button>
                                </div>
                                <div>
                                    <button id="cancel-karrasa-edit" class="bg-gray-500 text-white text-sm rounded-lg px-4 py-2 hover:bg-gray-600">Ø¥Ù„ØºØ§Ø¡</button>
                                    <button id="save-karrasa-edit" class="bg-blue-600 text-white text-sm rounded-lg px-4 py-2 hover:bg-blue-700 mr-2">Ø­ÙØ¸ Ø§Ù„ÙƒØ±Ø§Ø³Ø©</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- BOQ Items Page -->
                    <div id="boq-items-page" class="page-content hidden">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold" style="color: var(--olive-dark);">Ø¨Ù†ÙˆØ¯ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙƒÙ…ÙŠØ§Øª</h2>
                            <button class="back-to-database-specs bg-gray-800 text-white text-sm rounded-lg px-4 py-2 hover:bg-black transition-colors">â†’ Ø§Ù„Ø±Ø¬ÙˆØ¹</button>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <div class="flex items-center gap-4 mb-4">
                                <button id="add-boq-item-btn" class="bg-blue-600 text-white text-sm rounded-lg px-4 py-2 hover:bg-blue-700"><span>â•</span> Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¯</button>
                                <button id="boq-import-excel" class="bg-teal-600 text-white text-sm rounded-lg px-4 py-2 hover:bg-teal-700 flex items-center gap-2"><span>ğŸ“¤</span> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Excel</button>
                                <button id="boq-export-all" class="bg-green-600 text-white text-sm rounded-lg px-4 py-2 hover:bg-green-700 flex items-center gap-2"><span>â¬‡ï¸</span> ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙ„ (Excel)</button>
                                <button id="boq-export-selected" disabled class="bg-yellow-500 text-white text-sm rounded-lg px-4 py-2 hover:bg-yellow-600 flex items-center gap-2"><span>â¬‡ï¸</span> ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø¯Ø¯ (Excel)</button>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full data-table">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="w-12"><input type="checkbox" id="boq-select-all-checkbox"></th>
                                            <th>Ø±Ù‚Ù… Ø§Ù„Ø¨Ù†Ø¯</th><th>Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ø¯</th><th>ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø¨ÙŠØ§Ù† Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</th><th>Ø§Ù„ÙØ¦Ø©</th><th>Ø§Ù„ØªØ®ØµØµ</th><th>Ø±Ø³Ù… ØªÙˆØ¶ÙŠØ­ÙŠ Ù„Ù„Ø¨Ù†Ø¯</th><th>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù†Ø¯</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody id="boq-items-table-body"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <input type="file" id="excel-file-input" class="hidden" accept=".xlsx, .xls">
                    <input type="file" id="word-file-input" class="hidden" accept=".docx">
                    <input type="file" id="excel-template-file-input" class="hidden" accept=".xlsx, .xls">

                    <!-- BOQ Templates Page -->
                    <div id="boq-templates-page" class="page-content hidden">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold" style="color: var(--olive-dark);">Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„ÙƒÙ…ÙŠØ§Øª</h2>
                             <div id="boq-editor-top-buttons" class="hidden">
                                <button class="back-to-boq-templates-list bg-gray-800 text-white text-sm rounded-lg px-4 py-2 hover:bg-black">â†’ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù‚ÙˆØ§Ù„Ø¨</button>
                             </div>
                        </div>

                        <div id="boq-templates-list-view">
                           <div class="bg-white p-6 rounded-xl shadow-lg">
                               <div class="flex items-center gap-4 mb-4">
                                   <button id="show-boq-template-editor-btn" data-template-id="new" class="bg-blue-600 text-white text-sm rounded-lg px-4 py-2 hover:bg-blue-700"><span>â•</span> Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙˆÙ„ Ø¬Ø¯ÙŠØ¯</button>
                               </div>
                               <div id="boq-templates-list" class="space-y-3">
                                   <p class="text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ÙˆØ§Ù„Ø¨ Ù…Ø­ÙÙˆØ¸Ø©.</p>
                               </div>
                           </div>
                        </div>
                        
                        <div id="boq-template-editor-view" class="hidden bg-white p-6 rounded-xl shadow-lg">
                             <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 border-b pb-4">
                                 <div>
                                     <label for="boqTemplateName" class="block text-sm font-medium">Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„</label>
                                     <input type="text" id="boqTemplateName" placeholder="Ù…Ø«Ø§Ù„: Ø¬Ø¯ÙˆÙ„ ÙƒÙ…ÙŠØ§Øª Ù…Ø¨Ù†Ù‰ Ø±Ø¦ÙŠØ³ÙŠ" class="mt-1 block w-full data-table input">
                                 </div>
                                 <div>
                                     <label for="boqTemplateCategory" class="block text-sm font-medium">Ø§Ù„ÙØ¦Ø©</label>
                                     <select id="boqTemplateCategory" class="mt-1 block w-full data-table select"></select>
                                 </div>
                                 <div>
                                     <label for="boqTemplateSpecialization" class="block text-sm font-medium">Ø§Ù„ØªØ®ØµØµ</label>
                                     <select id="boqTemplateSpecialization" class="mt-1 block w-full data-table select"></select>
                                 </div>
                            </div>
                             <div class="flex justify-between items-center mb-4 flex-wrap gap-4">
                                <div id="boq-editor-actions" class="flex items-center gap-2 flex-wrap">
                                    <button id="addBoqTemplateRow" class="bg-blue-500 text-white text-sm rounded-md px-3 py-1.5 hover:bg-blue-600 flex items-center gap-1">â• <span>Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¯</span></button>
                                    <button id="boq-template-import-excel" class="bg-teal-600 text-white text-sm rounded-md px-3 py-1.5 hover:bg-teal-700 flex items-center gap-2"><span>ğŸ“¤</span> Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
                                    <button id="boq-template-export-all" class="bg-green-600 text-white text-sm rounded-md px-3 py-1.5 hover:bg-green-700 flex items-center gap-2"><span>â¬‡ï¸</span> ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙ„</button>
                                    <button id="boq-template-export-selected" disabled class="bg-yellow-500 text-white text-sm rounded-md px-3 py-1.5 hover:bg-yellow-600 flex items-center gap-2"><span>â¬‡ï¸</span> ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø¯Ø¯</button>
                                </div>
                                <div class="relative">
                                    <input type="text" id="boqSearch" placeholder="Ø¨Ø­Ø«..." class="data-table input pr-8">
                                    <span class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400">ğŸ”</span>
                                </div>
                             </div>

                             <div class="overflow-x-auto">
                                <table id="boq-template-table" class="min-w-full text-sm boq-template-table data-table">
                                     <thead class="bg-gray-200">
                                         <tr>
                                            <th class="p-2"><input type="checkbox" id="boq-template-select-all"></th>
                                            <th>ÙƒÙˆØ¯ Ø§Ù„Ø¨Ù†Ø¯</th>
                                            <th>Ø±Ù‚Ù… Ø§Ù„Ø¨Ù†Ø¯</th>
                                            <th>Ø¨ÙŠØ§Ù† Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</th>
                                            <th>ÙØ¦Ø© Ø§Ù„Ø¨Ù†Ø¯</th>
                                            <th>Ø§Ù„ÙˆØ­Ø¯Ø©</th>
                                            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                            <th>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥ÙØ±Ø§Ø¯ÙŠ (Ø±Ù‚Ù…Ø§Ù‹)</th>
                                            <th>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥ÙØ±Ø§Ø¯ÙŠ (ÙƒØªØ§Ø¨Ø©)</th>
                                            <th>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø±Ù‚Ù…Ø§Ù‹)</th>
                                            <th>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (ÙƒØªØ§Ø¨Ø©)</th>
                                            <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                                         </tr>
                                     </thead>
                                     <tbody>
                                        </tbody>
                                     <tfoot class="bg-gray-200 font-bold">
                                         <tr>
                                             <td colspan="10" class="p-3 text-left">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ù„Ø£Ø¹Ù…Ø§Ù„ (ÙÙ‚Ø· Ù„Ø§ ØºÙŠØ±)</td>
                                             <td id="boq-grand-total" class="p-3 text-center" colspan="2">0.00 Ø±ÙŠØ§Ù„</td>
                                         </tr>
                                     </tfoot>
                                 </table>
                             </div>
                             <div class="flex justify-between items-center mt-4">
                                 <div class="text-sm text-gray-600">
                                     <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ù†ÙˆØ¯:</span>
                                     <span id="boq-item-count">0</span>
                                 </div>
                                 <div id="boq-pagination" class="flex items-center gap-2 text-sm">
                                     <button id="boq-prev-page" class="px-2 py-1 rounded bg-gray-300 hover:bg-gray-400 disabled:opacity-50">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
                                     <span>ØµÙØ­Ø© <span id="boq-current-page">1</span> Ù…Ù† <span id="boq-total-pages">1</span></span>
                                     <button id="boq-next-page" class="px-2 py-1 rounded bg-gray-300 hover:bg-gray-400 disabled:opacity-50">Ø§Ù„ØªØ§Ù„ÙŠ</button>
                                 </div>
                                 <div id="boq-editor-save-actions">
                                    <button id="cancel-boq-template" class="bg-gray-500 text-white text-sm rounded-lg px-4 py-2 hover:bg-gray-600">Ø¥Ù„ØºØ§Ø¡</button>
                                    <button id="save-boq-template" class="bg-green-600 text-white text-sm rounded-lg px-4 py-2 hover:bg-green-700 mr-2">Ø­ÙØ¸ Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
                                 </div>
                             </div>
                        </div>
                    </div>
                    
                    <!-- Database & Specs Sub-page -->
                    <div id="database-specs-sub" class="page-content hidden">
                        <h2 class="text-2xl font-bold mb-6" style="color: var(--olive-dark);">Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ùˆ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <div id="show-karrasa-page" class="functional-card cursor-pointer bg-white p-6 rounded-xl shadow-lg flex flex-col items-center text-center">
                                <div class="w-20 h-20 rounded-full bg-indigo-100 flex items-center justify-center mb-4"><span class="text-4xl">ğŸ“‘</span></div>
                                <h3 class="font-bold text-xl portal-theme-text">ÙƒØ±Ø§Ø³Ø© Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ù…ÙˆØ§ØµÙØ§Øª</h3>
                                <p class="text-sm text-gray-500 mt-2">Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªØ¹Ø¯ÙŠÙ„ ÙƒØ±Ø§Ø³Ø§Øª Ø§Ù„Ø´Ø±ÙˆØ· ÙƒÙ†Ù…Ø§Ø°Ø¬.</p>
                            </div>
                            <div id="show-boq-items-page" class="functional-card cursor-pointer bg-white p-6 rounded-xl shadow-lg flex flex-col items-center text-center">
                                <div class="w-20 h-20 rounded-full bg-blue-100 flex items-center justify-center mb-4"><span class="text-4xl">ğŸ“</span></div>
                                <h3 class="font-bold text-xl portal-theme-text">Ø¨Ù†ÙˆØ¯ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙƒÙ…ÙŠØ§Øª</h3>
                                <p class="text-sm text-gray-500 mt-2">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„ÙØ±Ø¯ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„ÙƒÙ…ÙŠØ§Øª.</p>
                            </div>
                            <div id="show-boq-templates-page" class="functional-card cursor-pointer bg-white p-6 rounded-xl shadow-lg flex flex-col items-center text-center">
                                <div class="w-20 h-20 rounded-full bg-green-100 flex items-center justify-center mb-4"><span class="text-4xl">ğŸ“‹</span></div>
                                <h3 class="font-bold text-xl portal-theme-text">Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„ÙƒÙ…ÙŠØ§Øª</h3>
                                <p class="text-sm text-gray-500 mt-2">Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªØ¹Ø¯ÙŠÙ„ Ù‚ÙˆØ§Ù„Ø¨ Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„ÙƒÙ…ÙŠØ§Øª Ù„Ù„Ù…Ø´Ø§Ø±ÙŠØ¹.</p>
                            </div>
                             <div id="show-models-page" class="functional-card cursor-pointer bg-white p-6 rounded-xl shadow-lg flex flex-col items-center text-center">
                                <div class="w-20 h-20 rounded-full bg-purple-100 flex items-center justify-center mb-4"><span class="text-4xl">ğŸ“</span></div>
                                <h3 class="font-bold text-xl portal-theme-text">Ø§Ù„Ù†Ù…Ø§Ø°Ø¬</h3>
                                <p class="text-sm text-gray-500 mt-2">Ù…Ø¬Ù„Ø¯Ø§Øª Ø±Ø¦ÙŠØ³ÙŠØ© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ù„ÙØ§Øª ÙˆÙ†Ù…Ø§Ø°Ø¬.</p>
                            </div>
                            <div id="show-regions-page" class="functional-card cursor-pointer bg-white p-6 rounded-xl shadow-lg flex flex-col items-center text-center">
                                <div class="w-20 h-20 rounded-full bg-red-100 flex items-center justify-center mb-4"><span class="text-4xl">ğŸ“</span></div>
                                <h3 class="font-bold text-xl portal-theme-text">Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</h3>
                                <p class="text-sm text-gray-500 mt-2">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ ÙˆØ§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª ÙˆØ§Ù„Ù…Ø±Ø§ÙƒØ² ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù….</p>
                            </div>
                            <div id="show-suppliers-page" class="functional-card cursor-pointer bg-white p-6 rounded-xl shadow-lg flex flex-col items-center text-center">
                                <div class="w-20 h-20 rounded-full bg-cyan-100 flex items-center justify-center mb-4"><span class="text-4xl">ğŸ‘¥</span></div>
                                <h3 class="font-bold text-xl portal-theme-text">Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</h3>
                                <p class="text-sm text-gray-500 mt-2">Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† ÙˆØªÙ‚ÙŠÙŠÙ…Ù‡Ù….</p>
                            </div>
                            <div id="show-materials-page" class="functional-card cursor-pointer bg-white p-6 rounded-xl shadow-lg flex flex-col items-center text-center">
                                <div class="w-20 h-20 rounded-full bg-orange-100 flex items-center justify-center mb-4"><span class="text-4xl">ğŸ§±</span></div>
                                <h3 class="font-bold text-xl portal-theme-text">Ø§Ù„Ù…ÙˆØ§Ø¯</h3>
                                <p class="text-sm text-gray-500 mt-2">Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ§Ø¯ØŒ Ø§Ù„Ù…ÙˆØ§ØµÙØ§ØªØŒ ÙˆØ§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†.</p>
                            </div>
                             <div id="show-samples-page" class="functional-card cursor-pointer bg-white p-6 rounded-xl shadow-lg flex flex-col items-center text-center">
                                <div class="w-20 h-20 rounded-full bg-teal-100 flex items-center justify-center mb-4"><span class="text-4xl">ğŸ“¦</span></div>
                                <h3 class="font-bold text-xl portal-theme-text">Ø§Ù„Ø¹ÙŠÙ†Ø§Øª</h3>
                                <p class="text-sm text-gray-500 mt-2">Ø¥Ø¯Ø§Ø±Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¹ÙŠÙ†Ø§Øª Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© Ù„Ù„Ø§Ø¹ØªÙ…Ø§Ø¯.</p>
                            </div>
                             <div id="show-item-illustrations-page" class="functional-card cursor-pointer bg-white p-6 rounded-xl shadow-lg flex flex-col items-center text-center">
                                <div class="w-20 h-20 rounded-full bg-yellow-100 flex items-center justify-center mb-4"><span class="text-4xl">ğŸ–¼ï¸</span></div>
                                <h3 class="font-bold text-xl portal-theme-text">Ø§Ù„Ø±Ø³Ù… Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠ Ù„Ù„Ø¨Ù†Ø¯</h3>
                                <p class="text-sm text-gray-500 mt-2">Ø¹Ø±Ø¶ Ø±Ø³ÙˆÙ…Ø§Øª ØªØ´Ø±Ø­ ÙƒÙŠÙÙŠØ© ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨Ù†Ø¯ Ø¹Ù…Ù„ÙŠØ§Ù‹.</p>
                            </div>
                            <div id="show-item-analysis-page" class="functional-card cursor-pointer bg-white p-6 rounded-xl shadow-lg flex flex-col items-center text-center">
                                <div class="w-20 h-20 rounded-full bg-lime-100 flex items-center justify-center mb-4"><span class="text-4xl">ğŸ“Š</span></div>
                                <h3 class="font-bold text-xl portal-theme-text">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù†Ø¯</h3>
                                <p class="text-sm text-gray-500 mt-2">ØªØ­Ù„ÙŠÙ„ ØªÙƒÙ„ÙØ© Ø§Ù„Ø¨Ù†Ø¯ ÙˆØªÙØµÙŠÙ„ Ù…ÙƒÙˆÙ†Ø§ØªÙ‡ (Ù…ÙˆØ§Ø¯ØŒ Ø¹Ù…Ø§Ù„Ø©ØŒ Ù…Ø¹Ø¯Ø§Øª...).</p>
                            </div>
                            <div id="show-attachments-page" class="functional-card cursor-pointer bg-white p-6 rounded-xl shadow-lg flex flex-col items-center text-center">
                                <div class="w-20 h-20 rounded-full bg-gray-100 flex items-center justify-center mb-4"><span class="text-4xl">ğŸ“</span></div>
                                <h3 class="font-bold text-xl portal-theme-text">Ø§Ù„Ù…Ù„Ø­Ù‚Ø§Øª</h3>
                                <p class="text-sm text-gray-500 mt-2">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ø­Ù‚Ø§Øª ÙˆØ§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©.</p>
                            </div>
                            <div id="show-mandatory-list-page" class="functional-card cursor-pointer bg-white p-6 rounded-xl shadow-lg flex flex-col items-center text-center">
                                <div class="w-20 h-20 rounded-full bg-red-100 flex items-center justify-center mb-4"><span class="text-4xl">âœ…</span></div>
                                <h3 class="font-bold text-xl portal-theme-text">Ù‚Ø§Ø¦Ù…Ø© Ø¥Ù„Ø²Ø§Ù…ÙŠØ©</h3>
                                <p class="text-sm text-gray-500 mt-2">Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ø´Ø±ÙˆØ· Ø£Ùˆ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ø¨ ØªÙˆØ§ÙØ±Ù‡Ø§ ÙÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹.</p>
                            </div>
                            <div id="show-local-content-page" class="functional-card cursor-pointer bg-white p-6 rounded-xl shadow-lg flex flex-col items-center text-center">
                                <div class="w-20 h-20 rounded-full bg-green-100 flex items-center justify-center mb-4"><span class="text-4xl">ğŸ‡¸ğŸ‡¦</span></div>
                                <h3 class="font-bold text-xl portal-theme-text">Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø­Ù„ÙŠ</h3>
                                <p class="text-sm text-gray-500 mt-2">ØªØªØ¨Ø¹ Ù†Ø³Ø¨ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø­Ù„ÙŠ.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Models Page -->
                    <div id="models-page" class="page-content hidden">
                        <!-- Content will be generated by JS -->
                    </div>

                    <!-- Regions Page -->
                    <div id="regions-page" class="page-content hidden">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold" style="color: var(--olive-dark);">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</h2>
                            <div class="flex items-center gap-2">
                                <button class="back-to-database-specs bg-gray-800 text-white text-sm rounded-lg px-4 py-2 hover:bg-black transition-colors">â†’ Ø§Ù„Ø±Ø¬ÙˆØ¹</button>
                                <button id="add-new-location-btn" class="bg-blue-600 text-white text-sm rounded-lg px-4 py-2 hover:bg-blue-700"><span>â•</span> Ø¥Ø¶Ø§ÙØ© Ù…ÙˆÙ‚Ø¹ Ø¬Ø¯ÙŠØ¯</button>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <div class="overflow-x-auto">
                                <table class="min-w-full data-table">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th>
                                            <th>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</th>
                                            <th>Ø§Ù„Ù…Ø±ÙƒØ²</th>
                                            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody id="locations-table-body"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Suppliers Page -->
                    <div id="suppliers-page" class="page-content hidden">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold" style="color: var(--olive-dark);">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</h2>
                            <div class="flex items-center gap-2">
                                <button class="back-to-database-specs bg-gray-800 text-white text-sm rounded-lg px-4 py-2 hover:bg-black transition-colors">â†’ Ø§Ù„Ø±Ø¬ÙˆØ¹</button>
                                <button id="add-new-supplier-btn" class="bg-blue-600 text-white text-sm rounded-lg px-4 py-2 hover:bg-blue-700"><span>â•</span> Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯ Ø¬Ø¯ÙŠØ¯</button>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <div class="overflow-x-auto">
                                <table class="min-w-full data-table">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯</th>
                                            <th>Ù†ÙˆØ¹ Ø§Ù„Ù…ÙˆØ±Ø¯</th>
                                            <th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th>
                                            <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                                            <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
                                            <th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th>
                                            <th>Ø§Ù„Ù…Ù„ÙØ§Øª</th>
                                            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody id="suppliers-table-body"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Materials Page -->
                    <div id="materials-page" class="page-content hidden">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold" style="color: var(--olive-dark);">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¯</h2>
                            <div class="flex items-center gap-2">
                                <button class="back-to-database-specs bg-gray-800 text-white text-sm rounded-lg px-4 py-2 hover:bg-black transition-colors">â†’ Ø§Ù„Ø±Ø¬ÙˆØ¹</button>
                                <button id="add-new-material-btn" class="bg-blue-600 text-white text-sm rounded-lg px-4 py-2 hover:bg-blue-700"><span>â•</span> Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <div class="overflow-x-auto">
                                <table class="min-w-full data-table">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                                            <th>Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„ÙÙ†ÙŠØ©</th>
                                            <th>Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯</th>
                                            <th>Ø³Ø¹Ø± Ø§Ù„Ø³ÙˆÙ‚ (ØªÙ‚Ø¯ÙŠØ±ÙŠ)</th>
                                            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody id="materials-table-body"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Samples Page -->
                    <div id="samples-page" class="page-content hidden">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold" style="color: var(--olive-dark);">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹ÙŠÙ†Ø§Øª</h2>
                            <div class="flex items-center gap-2">
                                <button class="back-to-database-specs bg-gray-800 text-white text-sm rounded-lg px-4 py-2 hover:bg-black transition-colors">â†’ Ø§Ù„Ø±Ø¬ÙˆØ¹</button>
                                <button id="add-new-sample-btn" class="bg-blue-600 text-white text-sm rounded-lg px-4 py-2 hover:bg-blue-700"><span>â•</span> Ø¥Ø¶Ø§ÙØ© Ø¹ÙŠÙ†Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <div class="overflow-x-auto">
                                <table class="min-w-full data-table">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th>Ø§Ø³Ù… Ø§Ù„Ø¹ÙŠÙ†Ø©</th>
                                            <th>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</th>
                                            <th>Ø§Ù„Ù…ÙˆØ±Ø¯/Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„</th>
                                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…</th>
                                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody id="samples-table-body"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Item Illustrations Page -->
                    <div id="item-illustrations-page" class="page-content hidden">
                        <!-- Content will be generated by JS -->
                    </div>
                    
                    <!-- Item Analysis Page -->
                    <div id="item-analysis-page" class="page-content hidden">
                        <!-- Content will be generated by JS -->
                    </div>
                    
                    <!-- Attachments Page -->
                    <div id="attachments-page" class="page-content hidden">
                        <!-- Content will be generated by JS -->
                    </div>

                    <!-- Mandatory List Page -->
                    <div id="mandatory-list-page" class="page-content hidden">
                        <!-- Content will be generated by JS -->
                    </div>

                    <!-- Local Content Page -->
                    <div id="local-content-page" class="page-content hidden">
                        <!-- Content will be generated by JS -->
                    </div>


                    <!-- Supplier Files Page -->
                    <div id="supplier-files-page" class="page-content hidden">
                        <!-- Content will be generated by JS -->
                    </div>

                     <div id="building-models-sub" class="page-content hidden">
                        <!-- Content will be generated by JS -->
                    </div>
                    <div id="engineering-supervision" class="page-content hidden"></div>
                    <div id="entities" class="page-content hidden"></div>
                    
                    <!-- Archive Page -->
                    <div id="archive" class="page-content hidden">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold" style="color: var(--olive-dark);">Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</h2>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <div class="flex items-center gap-4 mb-4">
                                <input type="text" id="archive-search" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù…Ù„ÙØŒ Ù…Ø´Ø±ÙˆØ¹ØŒ Ù…Ø³ØªØ®Ø¯Ù…..." class="data-table input w-full md:w-1/3">
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full data-table">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th>Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù</th>
                                            <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</th>
                                            <th>Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</th>
                                            <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©</th>
                                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                                        </tr>
                                    </thead>
                                    <tbody id="archive-table-body">
                                        </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Notifications Log Page -->
                    <div id="notifications-log" class="page-content hidden">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold" style="color: var(--olive-dark);">Ø³Ø¬Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª (Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª)</h2>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <div class="flex items-center gap-4 mb-4">
                                <input type="text" id="notifications-search" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø³Ø¬Ù„..." class="data-table input w-full md:w-1/3">
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full data-table">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                            <th>Ø§Ù„Ù‚Ø³Ù…</th>
                                            <th>Ø§Ù„Ø¹Ù†ØµØ±</th>
                                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                                            <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                            <th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
                                        </tr>
                                    </thead>
                                    <tbody id="notifications-log-table-body">
                                        </tbody>
                                </table>
                            </div>
                        </div>
                    </div>


                </main>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="documentViewModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden items-center justify-center p-4 modal-backdrop">
        <div id="document-modal-content-wrapper" class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col modal-content">
             <div class="p-4 border-b flex justify-between items-center"><h3 id="document-view-title" class="text-xl font-bold portal-theme-text"></h3><button class="close-modal text-gray-400">&times;</button></div>
             <div class="p-6 flex-1 overflow-y-auto" id="document-viewer-content"></div>
             <div class="p-4 bg-gray-50 border-t flex justify-end"><button id="downloadDocumentBtn" class="bg-gray-800 text-white text-sm rounded-lg px-4 py-2 hover:bg-black">ØªØ­Ù…ÙŠÙ„</button></div>
        </div>
    </div>
    <div id="addProjectModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden items-center justify-center p-4 modal-backdrop">
        <form id="addProjectForm" class="bg-white rounded-2xl shadow-2xl w-full max-w-xl modal-content">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 class="text-xl font-bold portal-theme-text">Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</h3>
                <button type="button" class="close-modal text-gray-400">&times;</button>
            </div>
            <div class="p-6">
                <div id="add-project-step-1"><h4 class="font-semibold text-lg mb-4">Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</h4><div id="add-project-type-container" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div></div>
                <div id="add-project-step-2" class="hidden"><h4 class="font-semibold text-lg mb-4">Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</h4><div id="add-project-region-container" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div></div>
                <div id="add-project-step-3" class="hidden"><h4 class="font-semibold text-lg mb-4">Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</h4><div><label for="newProjectName" class="block text-sm font-medium">Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label><input type="text" id="newProjectName" required class="mt-1 data-table input"></div></div>
            </div>
            <div class="p-4 bg-gray-50 border-t flex justify-end space-x-2 space-x-reverse">
                <button type="button" id="backAddProjectStep" class="bg-gray-200 text-gray-700 text-sm rounded-lg px-4 py-2 hover:bg-gray-300 hidden">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
                <button type="submit" id="submitAddProject" class="text-white text-sm rounded-lg px-4 py-2 hidden" style="background-color: var(--olive-dark);">Ø¥Ù†Ø´Ø§Ø¡</button>
            </div>
        </form>
    </div>
    <div id="addCategoryModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden items-center justify-center p-4 modal-backdrop">
        <form id="addCategoryForm" class="bg-white rounded-2xl shadow-2xl w-full max-w-md modal-content">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 class="text-xl font-bold portal-theme-text">Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø© Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯Ø©</h3>
                <button type="button" class="close-modal text-gray-400 hover:text-gray-800 text-3xl leading-none">&times;</button>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label for="newCategoryName" class="block text-sm font-medium text-gray-700">Ø§Ø³Ù… Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                    <input type="text" id="newCategoryName" required placeholder="Ù…Ø«Ø§Ù„: Ø£Ø¹Ù…Ø§Ù„ ØµÙŠØ§Ù†Ø©" class="mt-1 data-table input">
                </div>
                <div>
                    <label for="newCategoryIcon" class="block text-sm font-medium text-gray-700">Ø§Ù„Ø±Ù…Ø² Ø§Ù„ØªØ¹Ø¨ÙŠØ±ÙŠ Ù„Ù„ÙØ¦Ø©</label>
                    <input type="text" id="newCategoryIcon" required placeholder="Ù…Ø«Ø§Ù„: ğŸ”§" class="mt-1 data-table input">
                </div>
            </div>
            <div class="p-4 bg-gray-50 border-t flex justify-end">
                <button type="submit" class="text-white text-sm rounded-lg px-4 py-2 transition-colors" style="background-color: var(--olive-dark);">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ¦Ø©</button>
            </div>
        </form>
    </div>
    <div id="addFileModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden items-center justify-center p-4 modal-backdrop">
        <form id="addFileForm" class="bg-white rounded-2xl shadow-2xl w-full max-w-lg modal-content">
             <div class="p-4 border-b flex justify-between items-center">
                <h3 id="addFileModalTitle" class="text-xl font-bold portal-theme-text">Ø¥Ø±ÙØ§Ù‚ Ù…Ù„ÙØ§Øª</h3>
                <button type="button" class="close-modal text-gray-400">&times;</button>
            </div>
             <div class="p-6 space-y-4">
                 <div>
                    <label for="attachFileInput" class="block text-sm font-medium text-gray-700 mb-2">Ø§Ø®ØªØ± Ù…Ù„Ù Ø£Ùˆ Ø¹Ø¯Ø© Ù…Ù„ÙØ§Øª</label>
                    <input type="file" id="attachFileInput" multiple class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-yellow-50 file:text-yellow-700 hover:file:bg-yellow-100"/>
                 </div>
                 <div id="file-preview-list" class="mt-4 space-y-2 max-h-40 overflow-y-auto"></div>
             </div>
             <div class="p-4 bg-gray-50 border-t flex justify-end space-x-2 space-x-reverse">
                <button type="button" class="close-modal bg-gray-200 text-gray-700 rounded-lg px-4 py-2 hover:bg-gray-300">Ø¥Ù„ØºØ§Ø¡</button>
                <button type="submit" class="text-white rounded-lg px-4 py-2" style="background-color: var(--olive-dark);">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</button>
            </div>
        </form>
    </div>
    <div id="addBoqItemModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden items-center justify-center p-4 modal-backdrop">
        <form id="addBoqItemForm" class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl modal-content">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 id="boqItemModalTitle" class="text-xl font-bold portal-theme-text">Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¯ Ø¬Ø¯ÙŠØ¯</h3>
                <button type="button" class="close-modal text-gray-400">&times;</button>
            </div>
            <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="hidden" id="boqItemId">
                <div><label for="boqItemNumber" class="block text-sm font-medium">Ø±Ù‚Ù… Ø§Ù„Ø¨Ù†Ø¯</label><input type="text" id="boqItemNumber" required class="mt-1 data-table input"></div>
                <div><label for="boqItemName" class="block text-sm font-medium">Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ø¯</label><input type="text" id="boqItemName" required class="mt-1 data-table input"></div>
                <div><label for="boqItemUnit" class="block text-sm font-medium">Ø§Ù„ÙˆØ­Ø¯Ø©</label><input type="text" id="boqItemUnit" required class="mt-1 data-table input"></div>
                <div><label for="boqItemPrice" class="block text-sm font-medium">Ø§Ù„Ø³Ø¹Ø±</label><input type="number" step="0.01" id="boqItemPrice" required class="mt-1 data-table input"></div>
                <div class="md:col-span-2"><label for="boqItemScope" class="block text-sm font-medium">Ø¨ÙŠØ§Ù† Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</label><textarea id="boqItemScope" rows="3" class="mt-1 data-table textarea"></textarea></div>
                <div><label for="boqItemCategory" class="block text-sm font-medium">Ø§Ù„ÙØ¦Ø©</label><select id="boqItemCategory" required class="mt-1 data-table select"></select></div>
                <div><label for="boqItemSpecialization" class="block text-sm font-medium">Ø§Ù„ØªØ®ØµØµ</label><select id="boqItemSpecialization" required class="mt-1 data-table select"></select></div>
            </div>
            <div class="p-4 bg-gray-50 border-t flex justify-end"><button type="submit" class="text-white rounded-lg px-4 py-2" style="background-color: var(--olive-dark);">Ø­ÙØ¸</button></div>
        </form>
    </div>
     <div id="addFolderModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden items-center justify-center p-4 modal-backdrop">
        <form id="addFolderForm" class="bg-white rounded-2xl shadow-2xl w-full max-w-md modal-content">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 class="text-xl font-bold portal-theme-text">Ø¥Ø¶Ø§ÙØ© Ù…Ø¬Ù„Ø¯ Ø¬Ø¯ÙŠØ¯</h3>
                <button type="button" class="close-modal text-gray-400 hover:text-gray-800 text-3xl leading-none">&times;</button>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label for="newFolderName" class="block text-sm font-medium text-gray-700">Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯</label>
                    <input type="text" id="newFolderName" required placeholder="Ù…Ø«Ø§Ù„: Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø£Ø³Ù‚Ù" class="mt-1 data-table input">
                </div>
            </div>
            <div class="p-4 bg-gray-50 border-t flex justify-end">
                <button type="submit" class="text-white text-sm rounded-lg px-4 py-2 transition-colors" style="background-color: var(--olive-dark);">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¬Ù„Ø¯</button>
            </div>
        </form>
    </div>
    <div id="addLocationModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden items-center justify-center p-4 modal-backdrop">
        <form id="addLocationForm" class="bg-white rounded-2xl shadow-2xl w-full max-w-md modal-content">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 id="locationModalTitle" class="text-xl font-bold portal-theme-text">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆÙ‚Ø¹ Ø¬Ø¯ÙŠØ¯</h3>
                <button type="button" class="close-modal text-gray-400">&times;</button>
            </div>
            <div class="p-6 space-y-4">
                <input type="hidden" id="locationId">
                <div>
                    <label for="locationRegion" class="block text-sm font-medium">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
                    <input type="text" id="locationRegion" required class="mt-1 data-table input">
                </div>
                <div>
                    <label for="locationGovernorate" class="block text-sm font-medium">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label>
                    <input type="text" id="locationGovernorate" required class="mt-1 data-table input">
                </div>
                <div>
                    <label for="locationCenter" class="block text-sm font-medium">Ø§Ù„Ù…Ø±ÙƒØ²</label>
                    <input type="text" id="locationCenter" required class="mt-1 data-table input">
                </div>
            </div>
            <div class="p-4 bg-gray-50 border-t flex justify-end">
                <button type="submit" class="text-white rounded-lg px-4 py-2" style="background-color: var(--olive-dark);">Ø­ÙØ¸</button>
            </div>
        </form>
    </div>
    <div id="addSupplierModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden items-center justify-center p-4 modal-backdrop">
        <form id="addSupplierForm" class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl modal-content">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 id="supplierModalTitle" class="text-xl font-bold portal-theme-text">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯ Ø¬Ø¯ÙŠØ¯</h3>
                <button type="button" class="close-modal text-gray-400">&times;</button>
            </div>
            <div class="p-6 space-y-4">
                <input type="hidden" id="supplierId">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div><label for="supplierName" class="block text-sm font-medium">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯</label><input type="text" id="supplierName" required class="mt-1 data-table input"></div>
                    <div><label for="supplierType" class="block text-sm font-medium">Ù†ÙˆØ¹ Ø§Ù„Ù…ÙˆØ±Ø¯</label><input type="text" id="supplierType" required class="mt-1 data-table input"></div>
                    <div><label for="supplierCity" class="block text-sm font-medium">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label><input type="text" id="supplierCity" required class="mt-1 data-table input"></div>
                    <div><label for="supplierPhone" class="block text-sm font-medium">Ø§Ù„Ù‡Ø§ØªÙ</label><input type="text" id="supplierPhone" required class="mt-1 data-table input"></div>
                    <div class="md:col-span-2"><label for="supplierEmail" class="block text-sm font-medium">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label><input type="email" id="supplierEmail" required class="mt-1 data-table input"></div>
                    <div>
                        <label class="block text-sm font-medium">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</label>
                        <div id="supplierRating" class="rating-stars flex flex-row-reverse justify-end text-3xl mt-1" dir="ltr">
                            <span data-value="5">â˜†</span><span data-value="4">â˜†</span><span data-value="3">â˜†</span><span data-value="2">â˜†</span><span data-value="1">â˜†</span>
                        </div>
                        <input type="hidden" id="supplierRatingValue" value="0">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium">Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª</label>
                    <div id="supplier-attachments-preview" class="mt-2 space-y-2"></div>
                    <button type="button" id="add-supplier-attachments-btn" class="mt-2 bg-teal-100 text-teal-700 text-sm rounded-lg px-4 py-2 hover:bg-teal-200"><span>â•</span> Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙÙ‚Ø§Øª</button>
                </div>
            </div>
            <div class="p-4 bg-gray-50 border-t flex justify-end">
                <button type="submit" class="text-white rounded-lg px-4 py-2" style="background-color: var(--olive-dark);">Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ±Ø¯</button>
            </div>
        </form>
    </div>
    <div id="addMaterialModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden items-center justify-center p-4 modal-backdrop">
        <form id="addMaterialForm" class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl modal-content">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 id="materialModalTitle" class="text-xl font-bold portal-theme-text">Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                <button type="button" class="close-modal text-gray-400">&times;</button>
            </div>
            <div class="p-6 space-y-4">
                <input type="hidden" id="materialId">
                <div>
                    <label for="materialName" class="block text-sm font-medium">Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                    <input type="text" id="materialName" required class="mt-1 data-table input">
                </div>
                <div>
                    <label for="materialSpecs" class="block text-sm font-medium">Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„ÙÙ†ÙŠØ©</label>
                    <textarea id="materialSpecs" rows="4" class="mt-1 data-table textarea"></textarea>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="materialSupplier" class="block text-sm font-medium">Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯</label>
                        <select id="materialSupplier" required class="mt-1 data-table select"></select>
                    </div>
                    <div>
                        <label for="materialPrice" class="block text-sm font-medium">Ø³Ø¹Ø± Ø§Ù„Ø³ÙˆÙ‚ (ØªÙ‚Ø¯ÙŠØ±ÙŠ)</label>
                        <input type="number" step="0.01" id="materialPrice" required class="mt-1 data-table input">
                    </div>
                </div>
            </div>
            <div class="p-4 bg-gray-50 border-t flex justify-end">
                <button type="submit" class="text-white rounded-lg px-4 py-2" style="background-color: var(--olive-dark);">Ø­ÙØ¸ Ø§Ù„Ù…Ø§Ø¯Ø©</button>
            </div>
        </form>
    </div>
    <div id="addSampleModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden items-center justify-center p-4 modal-backdrop">
        <form id="addSampleForm" class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl modal-content">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 id="sampleModalTitle" class="text-xl font-bold portal-theme-text">Ø¥Ø¶Ø§ÙØ© Ø¹ÙŠÙ†Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                <button type="button" class="close-modal text-gray-400">&times;</button>
            </div>
            <div class="p-6 space-y-4 max-h-[75vh] overflow-y-auto">
                <input type="hidden" id="sampleId">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div><label for="sampleName" class="block text-sm font-medium">Ø§Ø³Ù… Ø§Ù„Ø¹ÙŠÙ†Ø©</label><input type="text" id="sampleName" required class="mt-1 data-table input"></div>
                    <div><label for="sampleSubmissionDate" class="block text-sm font-medium">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…</label><input type="date" id="sampleSubmissionDate" required class="mt-1 data-table input"></div>
                    <div><label for="sampleProject" class="block text-sm font-medium">Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label><select id="sampleProject" required class="mt-1 data-table select"></select></div>
                    <div><label for="sampleSupplier" class="block text-sm font-medium">Ø§Ù„Ù…ÙˆØ±Ø¯/Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„</label><select id="sampleSupplier" required class="mt-1 data-table select"></select></div>
                </div>
                <div><label for="sampleDescription" class="block text-sm font-medium">ÙˆØµÙ Ø§Ù„Ø¹ÙŠÙ†Ø©</label><textarea id="sampleDescription" rows="3" class="mt-1 data-table textarea"></textarea></div>
                <div>
                    <label class="block text-sm font-medium">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                    <div class="mt-2 flex items-center gap-x-6" id="sampleStatusContainer">
                        <label><input type="radio" name="sampleStatus" value="ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©" class="mr-2">ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</label>
                        <label><input type="radio" name="sampleStatus" value="Ù…Ø¹ØªÙ…Ø¯Ø©" class="mr-2">Ù…Ø¹ØªÙ…Ø¯Ø©</label>
                        <label><input type="radio" name="sampleStatus" value="Ù…Ø±ÙÙˆØ¶Ø©" class="mr-2">Ù…Ø±ÙÙˆØ¶Ø©</label>
                    </div>
                </div>
                <div id="sampleNotesContainer" class="hidden"><label for="sampleNotes" class="block text-sm font-medium">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯/Ø§Ù„Ø±ÙØ¶</label><textarea id="sampleNotes" rows="3" class="mt-1 data-table textarea"></textarea></div>
                <div>
                    <label class="block text-sm font-medium">Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª (ØµÙˆØ±)</label>
                    <div id="sample-attachments-preview" class="mt-2 grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-2"></div>
                    <button type="button" id="add-sample-attachments-btn" class="mt-2 bg-teal-100 text-teal-700 text-sm rounded-lg px-4 py-2 hover:bg-teal-200"><span>â•</span> Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±</button>
                </div>
            </div>
            <div class="p-4 bg-gray-50 border-t flex justify-end">
                <button type="submit" class="text-white rounded-lg px-4 py-2" style="background-color: var(--olive-dark);">Ø­ÙØ¸ Ø§Ù„Ø¹ÙŠÙ†Ø©</button>
            </div>
        </form>
    </div>
    <div id="confirmationModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden items-center justify-center p-4 modal-backdrop">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md modal-content">
            <div class="p-6 text-center">
                <div class="w-16 h-16 rounded-full bg-red-100 mx-auto flex items-center justify-center text-3xl">âš ï¸</div>
                <h3 id="confirmationModalTitle" class="text-xl font-bold mt-5">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ</h3>
                <p id="confirmationModalText" class="text-gray-500 text-sm my-2">Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.</p>
            </div>
            <div class="p-4 bg-gray-50 border-t flex justify-center space-x-2 space-x-reverse">
                <button id="confirmDeleteBtn" class="bg-red-600 text-white text-sm rounded-lg px-4 py-2 hover:bg-red-700 transition-colors">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</button>
                <button id="cancelDeleteBtn" class="bg-gray-200 text-gray-700 text-sm rounded-lg px-4 py-2 hover:bg-gray-300 transition-colors">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>
    <!-- Generic Message Modal -->
    <div id="messageModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden items-center justify-center p-4 modal-backdrop">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm modal-content">
            <div class="p-6 text-center">
                <div id="messageModalIcon" class="w-16 h-16 rounded-full mx-auto flex items-center justify-center text-3xl mb-4"></div>
                <h3 id="messageModalTitle" class="text-xl font-bold mt-2"></h3>
                <p id="messageModalText" class="text-gray-500 text-sm my-2"></p>
            </div>
            <div class="p-4 bg-gray-50 border-t flex justify-center">
                <button id="messageModalCloseBtn" class="bg-gray-800 text-white text-sm rounded-lg px-6 py-2 hover:bg-black transition-colors">Ù…ÙˆØ§ÙÙ‚</button>
            </div>
        </div>
    </div>
    
    <!-- Add Staged Project Modal -->
    <div id="addStagedProjectModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden items-center justify-center p-4 modal-backdrop">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl modal-content">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 class="text-xl font-bold portal-theme-text">Ø§Ø®ØªØ± Ù…Ø´Ø±ÙˆØ¹Ø§Ù‹ Ù„Ø¥Ø¶Ø§ÙØªÙ‡ Ù„Ù„ØªØ­Ø¶ÙŠØ±</h3>
                <button type="button" class="close-modal text-gray-400">&times;</button>
            </div>
            <div id="staged-project-selection-list" class="p-6 max-h-[60vh] overflow-y-auto">
                <!-- Project list will be populated here -->
            </div>
            <div class="p-4 bg-gray-50 border-t flex justify-end">
                <button type="button" class="close-modal bg-gray-200 text-gray-700 rounded-lg px-4 py-2 hover:bg-gray-300">Ø¥Ù„ØºØ§Ø¡</button>
                <button type="button" id="confirm-add-staged-project" class="text-white rounded-lg px-4 py-2 mr-2" style="background-color: var(--olive-dark);">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­Ø¯Ø¯</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            /**
             * Main application object to encapsulate all logic.
             * This structure makes the code more organized, scalable, and easier to maintain.
             */
            const App = {
                // --- STATE MANAGEMENT ---
                // Holds the current state of the application.
                state: {
                    currentUser: { name: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…', role: 'Ù…Ø³Ø¤ÙˆÙ„ Ø£ÙˆÙ„' },
                    currentProjectStatus: '',
                    currentRegion: 'all',
                    newProjectData: {},
                    currentAddFileContext: {},
                    currentDocumentListViewContext: {},
                    currentBoqTemplateData: [],
                    currentBoqTemplatePage: 1,
                    BOQ_ROWS_PER_PAGE: 6,
                    currentEditingContext: {},
                    currentModelPath: [null],
                    currentBuildingModelPath: [null],
                    currentItemIllustrationPath: [null],
                    currentItemAnalysisPath: [null], // FIX: Added missing state property
                    currentAttachmentsPath: [null],
                    currentMandatoryListPath: [null],
                    currentLocalContentPath: [null],
                    currentSupplierFileContext: { id: null, path: [null] },
                    barChart: null,
                },

                // --- DOM SELECTORS ---
                // Caches frequently accessed DOM elements.
                DOM: {
                    pages: null,
                    pageTitle: null,
                    sidebar: null,
                    mainContent: null,
                    notificationBell: null,
                    notificationIndicator: null,
                    notificationsDropdown: null,
                    notificationsList: null,
                },
                
                // --- UTILITY & HELPER FUNCTIONS ---
                utils: {
                    utf8_to_b64: (str) => btoa(unescape(encodeURIComponent(str))),
                    b64DecodeUnicode: (str) => {
                        try {
                            const binaryStr = atob(str);
                            const len = binaryStr.length;
                            const bytes = new Uint8Array(len);
                            for (let i = 0; i < len; i++) {
                                bytes[i] = binaryStr.charCodeAt(i);
                            }
                            return new TextDecoder().decode(bytes);
                        } catch (e) {
                            console.error("Base64 decoding failed:", e);
                            return "Error: Could not decode content.";
                        }
                    },
                    Tafqit: new (function () { const const_n0=["ØµÙØ±","ÙˆØ§Ø­Ø¯","Ø§Ø«Ù†Ø§Ù†","Ø«Ù„Ø§Ø«Ø©","Ø£Ø±Ø¨Ø¹Ø©","Ø®Ù…Ø³Ø©","Ø³ØªØ©","Ø³Ø¨Ø¹Ø©","Ø«Ù…Ø§Ù†ÙŠØ©","ØªØ³Ø¹Ø©","Ø¹Ø´Ø±Ø©","Ø£Ø­Ø¯ Ø¹Ø´Ø±","Ø§Ø«Ù†Ø§ Ø¹Ø´Ø±","Ø«Ù„Ø§Ø«Ø© Ø¹Ø´Ø±","Ø£Ø±Ø¨Ø¹Ø© Ø¹Ø´Ø±","Ø®Ù…Ø³Ø© Ø¹Ø´Ø±","Ø³ØªØ© Ø¹Ø´Ø±","Ø³Ø¨Ø¹Ø© Ø¹Ø´Ø±","Ø«Ù…Ø§Ù†ÙŠØ© Ø¹Ø´Ø±","ØªØ³Ø¹Ø© Ø¹Ø´Ø±"],const_n1=["","","Ø¹Ø´Ø±ÙˆÙ†","Ø«Ù„Ø§Ø«ÙˆÙ†","Ø£Ø±Ø¨Ø¹ÙˆÙ†","Ø®Ù…Ø³ÙˆÙ†","Ø³ØªÙˆÙ†","Ø³Ø¨Ø¹ÙˆÙ†","Ø«Ù…Ø§Ù†ÙˆÙ†","ØªØ³Ø¹ÙˆÙ†"],const_n2=["","Ù…Ø¦Ø©","Ù…Ø¦ØªØ§Ù†","Ø«Ù„Ø§Ø«Ù…Ø§Ø¦Ø©","Ø£Ø±Ø¨Ø¹Ù…Ø§Ø¦Ø©","Ø®Ù…Ø³Ù…Ø§Ø¦Ø©","Ø³ØªÙ…Ø§Ø¦Ø©","Ø³Ø¨Ø¹Ù…Ø§Ø¦Ø©","Ø«Ù…Ø§Ù†Ù…Ø§Ø¦Ø©","ØªØ³Ø¹Ù…Ø§Ø¦Ø©"],const_n3=[{s:"Ù…Ù„ÙŠØ§Ø±",p:"Ù…Ù„ÙŠØ§Ø±Ø§Øª"},{s:"Ù…Ù„ÙŠÙˆÙ†",p:"Ù…Ù„Ø§ÙŠÙŠÙ†"},{s:"Ø£Ù„Ù",p:"Ø¢Ù„Ø§Ù"},{s:"",p:""}];function convert999(e){let t=parseInt(e[0]),n=parseInt(e[1]),a=parseInt(e[2]),r=parseInt(e.substr(1)),s="";return t>0&&(s=const_n2[t]),r>0&&(t>0&&(s+=" Ùˆ"),r<20?s+=const_n0[r]:(a>0&&(s+=const_n0[a]),n>0&&(a>0&&(s+=" Ùˆ"),s+=const_n1[n]))),s}function int2Text(e){if("0"==e)return const_n0[0];let t=Math.floor(e.length/3)+(e.length%3>0?1:0);e.length%3!=0&&(e=("00"+e).slice(-3*t));let n=[];for(let a=0;a<t;a++){let r=e.substr(3*a,3),s=parseInt(r);if(0===s)continue;let o=convert999(r),i=t-a-1;i>0&&(1===s?o=const_n3[i].s:2===s?o="Ø£Ù„Ù"===const_n3[i].s?"Ø£Ù„ÙØ§Ù†":const_n3[i].s.replace(/.$/,"Ø§Ù†"):s>=3&&s<=10?o+=" "+const_n3[i].p:o+=" "+const_n3[i].s),n.push(o)}return n.join(" Ùˆ")}this.toText=function(e,t){t=t||{};if(null===e||isNaN(e))return"";let n=parseFloat(e).toFixed(2),a=n.split("."),r=a[0],s=a[1],o=int2Text(r);return t.currency&&(o?o+=" "+(t.currency.singular||"Ø±ÙŠØ§Ù„"):"0"==parseInt(s)&&(o="ØµÙØ± Ø±ÙŠØ§Ù„"),s&&parseInt(s)>0&&("0"!=r&&(o+=" Ùˆ"),o+=int2Text(s)+" "+(t.currency.fraction||"Ù‡Ù„Ù„Ø©"))),o} })(),
                    synth: new Tone.Synth().toDestination(),
                    getFileIcon: (fileType) => {
                        if (!fileType) return 'ğŸ“„';
                        const lowerType = fileType.toLowerCase();
                        if (lowerType.startsWith('image/')) return 'ğŸ–¼ï¸';
                        if (lowerType.includes('pdf')) return 'ğŸ“•';
                        if (lowerType.includes('word')) return 'ğŸ“˜';
                        if (lowerType.includes('excel') || lowerType.includes('spreadsheet')) return 'ğŸ“—';
                        if (lowerType.includes('dwg') || lowerType.includes('dxf') || lowerType.includes('vnd.dwg')) return 'ğŸ“';
                        return 'ğŸ“„';
                    },
                },

                // --- DATA STORE ---
                // Simulates a database, centralizing all data and operations.
                // This makes it easy to replace with a real database in the future.
                DB: {
                    activityLog: [],
                    locationsData: [
                        { id: 1, region: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±ÙŠØ§Ø¶', governorate: 'Ø§Ù„Ø±ÙŠØ§Ø¶', center: 'Ø§Ù„Ø±ÙŠØ§Ø¶' },
                        { id: 2, region: 'Ù…Ù†Ø·Ù‚Ø© Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©', governorate: 'Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©', center: 'Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©' },
                        { id: 3, region: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©', governorate: 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©', center: 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©' },
                        { id: 4, region: 'Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©', governorate: 'Ø§Ù„Ø¯Ù…Ø§Ù…', center: 'Ø§Ù„Ø¯Ù…Ø§Ù…' },
                    ],
                    suppliersData: [
                        { id: 1, name: 'Ø´Ø±ÙƒØ© Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©', type: 'ØªÙ‚Ù†ÙŠØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', city: 'Ø§Ù„Ø±ÙŠØ§Ø¶', phone: '0512345678', email: 'info@system.com', rating: 4, files: [] },
                        { id: 2, name: 'Ù…Ù‚Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø¥Ø¹Ù…Ø§Ø±', type: 'Ø¥Ù†Ø´Ø§Ø¡Ø§Øª', city: 'Ø¬Ø¯Ø©', phone: '0587654321', email: 'contact@emaar-c.com', rating: 5, files: [] }
                    ],
                    materialsData: [
                        { id: 1, name: 'Ø®Ø±Ø³Ø§Ù†Ø© Ø¬Ø§Ù‡Ø²Ø© Ù…Ù‚Ø§ÙˆÙ…Ø©', specs: 'Ø¥Ø¬Ù‡Ø§Ø¯ 350 ÙƒØ¬Ù…/Ø³Ù…2ØŒ Ù…Ø­ØªÙˆÙ‰ Ø£Ø³Ù…Ù†Øª 350 ÙƒØ¬Ù…', supplierId: 2, price: 250 },
                        { id: 2, name: 'Ø·ÙˆØ¨ Ø£Ø³Ù…Ù†ØªÙŠ Ù…ØµÙ…Øª', specs: 'Ù…Ù‚Ø§Ø³ 20*20*40 Ø³Ù…', supplierId: 2, price: 2.5 },
                        { id: 3, name: 'Ø¯Ù‡Ø§Ù† Ø¨Ù„Ø§Ø³ØªÙŠÙƒ Ù†ØµÙ Ù„Ø§Ù…Ø¹', specs: 'Ø§Ù„Ù„ÙˆÙ† Ø£Ø¨ÙŠØ¶ØŒ Ù‚Ø§Ø¨Ù„ Ù„Ù„ØºØ³ÙŠÙ„', supplierId: 1, price: 150 }
                    ],
                    projects: [
                        { id: 1, name: 'ØªØ·ÙˆÙŠØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¨Ø­Ø±ÙŠØ©', type: 'Ø§Ù†Ø´Ø§Ø¡Ø§Øª', region: 'Ù…Ù†Ø·Ù‚Ø© Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©', status: 'Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©', docs: [101, 102], completion: 10 },
                        { id: 2, name: 'Ø¨Ù†Ø§Ø¡ Ù…Ø¬Ù…Ø¹ Ø³ÙƒÙ†ÙŠ', type: 'Ø§Ù†Ø´Ø§Ø¡Ø§Øª', region: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±ÙŠØ§Ø¶', status: 'Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©', docs: [201], completion: 100 },
                        { id: 3, name: 'ØªØ±Ù…ÙŠÙ… Ù…Ø¨Ù†Ù‰ ØªØ§Ø±ÙŠØ®ÙŠ', type: 'ØªØ±Ù…ÙŠÙ…Ø§Øª', region: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©', status: 'Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©', docs: [301], completion: 100 },
                        { id: 4, name: 'ØªÙˆØ±ÙŠØ¯ Ø£Ø¬Ù‡Ø²Ø© Ø­Ø§Ø³Ø¨', type: 'ØªÙˆØ±ÙŠØ¯Ø§Øª', region: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±ÙŠØ§Ø¶', status: 'Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©', docs: [], completion: 5 },
                        { id: 5, name: 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¯ÙŠÙ‚Ø© Ø¹Ø§Ù…Ø©', type: 'Ø§Ù†Ø´Ø§Ø¡Ø§Øª', region: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±ÙŠØ§Ø¶', status: 'Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø·Ø±Ø­', docs: [501, 502], completion: 75 },
                        { id: 6, name: 'ØªÙˆØ±ÙŠØ¯ Ø£Ø«Ø§Ø« Ù…ÙƒØªØ¨ÙŠ', type: 'ØªÙˆØ±ÙŠØ¯Ø§Øª', region: 'Ù…Ù†Ø·Ù‚Ø© Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©', status: 'Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø·Ø±Ø­', docs: [], completion: 40 },
                        { id: 7, name: 'Ø¯Ø±Ø§Ø³Ø© Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø±ÙƒØ² Ø¨ÙŠØ§Ù†Ø§Øª', type: 'Ø§Ù†Ø´Ø§Ø¡Ø§Øª', region: 'Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©', status: 'Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¬Ø§Ø±ÙŠ Ø¯Ø±Ø§Ø³ØªÙ‡Ø§', docs: [], completion: 15 },
                        { id: 8, name: 'Ø®Ø·Ø© ØªÙˆØ³Ø¹Ø© Ø§Ù„Ø³Ø¬ÙˆÙ† 2030', type: 'Ø§Ù†Ø´Ø§Ø¡Ø§Øª', region: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±ÙŠØ§Ø¶', status: 'Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©', docs: [], completion: 0 }
                    ],
                    documentArchive: [], // Initialized as empty, will be populated in initData
                    boqItems: [
                        { id: 1, number: '101', name: 'Ø£Ø¹Ù…Ø§Ù„ Ø­ÙØ±', unit: 'Ù…3', price: 75, scope: 'Ø­ÙØ± ÙˆØªØ±Ø­ÙŠÙ„', category: 'Ø¥Ù†Ø´Ø§Ø¦ÙŠ', specialization: 'Ù…Ø¯Ù†ÙŠ' },
                        { id: 2, number: '205', name: 'Ø£Ø¨ÙˆØ§Ø¨ Ø®Ø´Ø¨', unit: 'Ø¹Ø¯Ø¯', price: 1200, scope: 'Ø¨Ø§Ø¨ Ø®Ø´Ø¨ Ø³ÙˆÙŠØ¯ÙŠ', category: 'Ù…Ø¹Ù…Ø§Ø±ÙŠ', specialization: 'ØªØ´Ø·ÙŠØ¨Ø§Øª' },
                    ],
                    boqTemplates: [],
                    karrasaTemplates: [{id: 1, name: "ÙƒØ±Ø§Ø³Ø© Ø´Ø±ÙˆØ· Ø¹Ø§Ù…Ø©", content: "Ù…Ø­ØªÙˆÙ‰ ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ù„ÙƒØ±Ø§Ø³Ø©..."}],
                    modelsData: [
                        { id: 'f1', type: 'folder', name: 'Ù†Ù…Ø§Ø°Ø¬ Ø¥Ù†Ø´Ø§Ø¦ÙŠØ©', parent: null, children: ['sf1-1', 'file1-1'] },
                        { id: 'f2', type: 'folder', name: 'Ù†Ù…Ø§Ø°Ø¬ Ù…Ø¹Ù…Ø§Ø±ÙŠØ©', parent: null, children: ['file2-1'] },
                        { id: 'sf1-1', type: 'folder', name: 'Ù†Ù…Ø§Ø°Ø¬ Ø£Ø³Ù‚Ù', parent: 'f1', children: ['file1-1-1'] },
                        { id: 'file1-1', type: 'file', name: 'ØªÙØµÙŠÙ„Ø© ØªØ³Ù„ÙŠØ­.pdf', parent: 'f1', content: null, fileType: 'application/pdf' },
                        { id: 'file2-1', type: 'file', name: 'Ù†Ù…ÙˆØ°Ø¬ ÙˆØ§Ø¬Ù‡Ø© Ø±Ø¦ÙŠØ³ÙŠØ©.docx', parent: 'f2', content: null, fileType: 'application/msword' },
                        { id: 'file1-1-1', type: 'file', name: 'ØªÙØµÙŠÙ„Ø© Ø³Ù‚Ù Ù‡ÙˆØ±Ø¯ÙŠ.pdf', parent: 'sf1-1', content: null, fileType: 'application/pdf' }
                    ],
                    buildingModelsData: [
                        { id: 'bm-f1', type: 'folder', name: 'Ù…Ø¨Ø§Ù†ÙŠ Ø£Ù…Ù†ÙŠØ©', parent: null, children: [] },
                        { id: 'bm-f2', type: 'folder', name: 'Ù…Ø¨Ø§Ù†ÙŠ Ø¥Ø¯Ø§Ø±ÙŠØ©', parent: null, children: [] },
                        { id: 'bm-f3', type: 'folder', name: 'Ù…Ø¨Ø§Ù†ÙŠ ØµØ­ÙŠØ©', parent: null, children: [] },
                        { id: 'bm-f4', type: 'folder', name: 'Ù…Ø¨Ø§Ù†ÙŠ ØªØ¹Ù„ÙŠÙ…ÙŠØ©', parent: null, children: [] },
                        { id: 'bm-f5', type: 'folder', name: 'Ù…Ø¨Ø§Ù†ÙŠ Ø®Ø¯Ù…ÙŠØ©', parent: null, children: [] },
                    ],
                    itemIllustrationsData: [ // New data store for illustrations
                        { id: 'ill-f1', type: 'folder', name: 'ØªÙØ§ØµÙŠÙ„ Ø¥Ù†Ø´Ø§Ø¦ÙŠØ©', parent: null },
                        { id: 'ill-f2', type: 'folder', name: 'ØªÙØ§ØµÙŠÙ„ Ù…Ø¹Ù…Ø§Ø±ÙŠØ©', parent: null },
                        { id: 'ill-file-1', type: 'file', name: 'ØªÙØµÙŠÙ„Ø© Ø¨Ø§Ø¨ ÙˆÙ†Ø§ÙØ°Ø©.dwg', parent: 'ill-f2', content: null, fileType: 'application/vnd.dwg' }
                    ],
                    itemAnalysisData: [
                        { id: 'ana-f1', type: 'folder', name: 'ØªØ­Ù„ÙŠÙ„ Ø¨Ù†ÙˆØ¯ Ø¥Ù†Ø´Ø§Ø¦ÙŠØ©', parent: null },
                        { id: 'ana-file-1', type: 'file', name: 'ØªØ­Ù„ÙŠÙ„ Ø³Ø¹Ø± Ø¨Ù†Ø¯ Ø®Ø±Ø³Ø§Ù†Ø©.xlsx', parent: 'ana-f1', content: null, fileType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' }
                    ],
                    attachmentsData: [
                        { id: 'att-f1', type: 'folder', name: 'Ù…Ù„Ø­Ù‚Ø§Øª Ø¹Ø§Ù…Ø©', parent: null },
                        { id: 'att-file-1', type: 'file', name: 'Ù†Ù…ÙˆØ°Ø¬ ØªØ¹Ù‡Ø¯.pdf', parent: 'att-f1', content: null, fileType: 'application/pdf' }
                    ],
                    mandatoryListData: [
                        { id: 'man-f1', type: 'folder', name: 'Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ø¬ÙˆØ¯Ø©', parent: null },
                        { id: 'man-file-1', type: 'file', name: 'Ù…ØªØ·Ù„Ø¨Ø§Øª ISO 9001.docx', parent: 'man-f1', content: null, fileType: 'application/msword' }
                    ],
                    localContentData: [
                        { id: 'loc-f1', type: 'folder', name: 'Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø­Ù„ÙŠ', parent: null },
                        { id: 'loc-file-1', type: 'file', name: 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ÙˆØ·Ù†ÙŠØ©.xlsx', parent: null, content: null, fileType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' }
                    ],
                    samplesData: [
                        { id: 1, name: 'Ø¹ÙŠÙ†Ø© Ø¨Ù„Ø§Ø· Ø³ÙŠØ±Ø§Ù…ÙŠÙƒ', projectId: 5, supplierId: 2, submissionDate: '2025-07-15', status: 'Ù…Ø¹ØªÙ…Ø¯Ø©', description: 'Ø¨Ù„Ø§Ø· Ø³ÙŠØ±Ø§Ù…ÙŠÙƒ Ø¥Ø³Ø¨Ø§Ù†ÙŠ Ù…Ù‚Ø§Ø³ 60x60 Ù„Ø²ÙˆÙ… Ø£Ø±Ø¶ÙŠØ§Øª Ø§Ù„Ù…ÙƒØ§ØªØ¨.', notes: 'ØªÙ… Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø·Ø§Ø¨Ù‚ØªÙ‡ Ù„Ù„Ù…ÙˆØ§ØµÙØ§Øª.', files: [] },
                        { id: 2, name: 'Ø¹ÙŠÙ†Ø© Ø¯Ù‡Ø§Ù† Ø®Ø§Ø±Ø¬ÙŠ', projectId: 1, supplierId: 1, submissionDate: '2025-07-20', status: 'ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', description: 'Ø¹ÙŠÙ†Ø© Ø¯Ù‡Ø§Ù† Ø¬ÙˆØªÙ† Ø®Ø§Ø±Ø¬ÙŠ Ù„ÙˆÙ† Ø¨ÙŠØ¬.', notes: '', files: [] }
                    ],
                    stagedProjects: [
                        { id: 5, name: 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¯ÙŠÙ‚Ø© Ø¹Ø§Ù…Ø©', type: 'Ø§Ù†Ø´Ø§Ø¡Ø§Øª', region: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±ÙŠØ§Ø¶', status: 'proposed', docs: { karrasa: [], mokhatat: [], jadwal: [], wathiqa: [] } },
                        { id: 1, name: 'ØªØ·ÙˆÙŠØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¨Ø­Ø±ÙŠØ©', type: 'Ø§Ù†Ø´Ø§Ø¡Ø§Øª', region: 'Ù…Ù†Ø·Ù‚Ø© Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©', status: 'proposed', docs: { karrasa: [{name: 'Karrasa_Test.pdf'}], mokhatat: [], jadwal: [], wathiqa: [] } },
                    ],
                    meta: {
                        availableCategories: ['Ø¥Ù†Ø´Ø§Ø¦ÙŠ', 'Ù…Ø¹Ù…Ø§Ø±ÙŠ', 'ÙƒÙ‡Ø±Ø¨Ø§Ø¡', 'Ù…ÙŠÙƒØ§Ù†ÙŠÙƒØ§'],
                        availableSpecializations: ['Ù…Ø¯Ù†ÙŠ', 'ØªØ´Ø·ÙŠØ¨Ø§Øª', 'Ù‚ÙˆÙ‰', 'ØªÙƒÙŠÙŠÙ'],
                        projTypeMeta: {'Ø§Ù†Ø´Ø§Ø¡Ø§Øª': { name: 'Ø§Ù„Ø§Ù†Ø´Ø§Ø¡Ø§Øª', icon: 'ğŸ—ï¸' },'ØªØ±Ù…ÙŠÙ…Ø§Øª': { name: 'Ø§Ù„ØªØ±Ù…ÙŠÙ…Ø§Øª', icon: 'ğŸ› ï¸' },'ØªÙˆØ±ÙŠØ¯Ø§Øª': { name: 'Ø§Ù„ØªÙˆØ±ÙŠØ¯Ø§Øª', icon: 'ğŸ“¦' }},
                        docTypeMeta: {'karrasa': { name: 'ÙƒØ±Ø§Ø³Ø§Øª Ø§Ù„Ø´Ø±ÙˆØ·', icon: 'ğŸ“„' },'mokhatat': { name: 'Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª', icon: 'ğŸ—ºï¸' },'jadwal': { name: 'Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙƒÙ…ÙŠØ§Øª', icon: 'ğŸ“‹' },'wathiqa': { name: 'ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ø²Ø§Ù…ÙŠØ©', icon: 'ğŸ“' }},
                    },

                    initData: function() {
                        this.documentArchive = [
                            {id: 101, projectId: 1, type: 'karrasa', name:'ÙƒØ±Ø§Ø³Ø© Ø´Ø±ÙˆØ· Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©.txt', fileType: 'text/plain', content: `data:text/plain;base64,${App.utils.utf8_to_b64('Ù…Ø­ØªÙˆÙ‰ ÙƒØ±Ø§Ø³Ø© Ø´Ø±ÙˆØ· Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¨Ø­Ø±ÙŠØ©...')}`, addedBy: 'Ø§Ù„Ù†Ø¸Ø§Ù…', addedDate: new Date('2023-01-15')},
                            {id: 102, projectId: 1, type: 'mokhatat', name:'Ù…Ø®Ø·Ø· Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©.pdf', fileType: 'application/pdf', content: null, addedBy: 'Ø§Ù„Ù†Ø¸Ø§Ù…', addedDate: new Date('2023-01-16')},
                            {id: 201, projectId: 2, type: 'jadwal', name:'Ø¬Ø¯ÙˆÙ„ ÙƒÙ…ÙŠØ§Øª Ø§Ù„Ù…Ø¬Ù…Ø¹.json', fileType: 'application/json', content: `data:application/json;base64,${App.utils.utf8_to_b64(JSON.stringify({ item: "example", quantity: 100 }))}`, addedBy: 'Ø§Ù„Ù†Ø¸Ø§Ù…', addedDate: new Date('2023-02-20')},
                            {id: 301, projectId: 3, type: 'mokhatat', name:'Ù…Ø®Ø·Ø· ØªØ±Ù…ÙŠÙ… Ø§Ù„Ù…Ø¨Ù†Ù‰.pdf', fileType: 'application/pdf', content: null, addedBy: 'Ø§Ù„Ù†Ø¸Ø§Ù…', addedDate: new Date('2023-03-10')},
                            {id: 501, projectId: 5, type: 'karrasa', name:'ÙƒØ±Ø§Ø³Ø© Ø´Ø±ÙˆØ· Ø§Ù„Ø­Ø¯ÙŠÙ‚Ø©.pdf', fileType: 'application/pdf', content: null, addedBy: 'Ø§Ù„Ù†Ø¸Ø§Ù…', addedDate: new Date('2023-05-05')},
                            {id: 502, projectId: 5, type: 'jadwal', name:'Ø¬Ø¯ÙˆÙ„ ÙƒÙ…ÙŠØ§Øª Ø§Ù„Ø­Ø¯ÙŠÙ‚Ø©.json', fileType: 'application/json', content: `data:application/json;base64,${App.utils.utf8_to_b64(JSON.stringify([{"id":1687611039893.328,"itemCode":"1001","itemNumber":"1","scope":"Ø£Ø¹Ù…Ø§Ù„ Ø­ÙØ± ÙˆØªØ±Ø­ÙŠÙ„ Ù†Ø§ØªØ¬ Ø§Ù„Ø­ÙØ± Ù„Ù…Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©","itemCategory":"Ø¥Ù†Ø´Ø§Ø¦ÙŠ","unit":"Ù…3","quantity":"250","unitPriceNum":"80"},{"id":1687611046788.8027,"itemCode":"2034","itemNumber":"2","scope":"ØªÙˆØ±ÙŠØ¯ ÙˆØªØ±ÙƒÙŠØ¨ Ø£Ø¨ÙˆØ§Ø¨ Ø®Ø´Ø¨ÙŠØ© Ù…Ù‚Ø§Ø³ 2.2*1.0 Ù…ØªØ± Ù…Ø¹ Ø§Ù„Ø­Ù„ÙˆÙ‚ ÙˆØ§Ù„Ø¯Ù‡Ø§Ù†","itemCategory":"Ù…Ø¹Ù…Ø§Ø±ÙŠ","unit":"Ø¹Ø¯Ø¯","quantity":"15","unitPriceNum":"1150"}]))}`, addedBy: 'Ø§Ù„Ù†Ø¸Ø§Ù…', addedDate: new Date('2023-05-06')}
                        ];
                    },
                    
                    logActivity(section, item, action, details) {
                        const logEntry = { date: new Date(), section, item, action, user: App.state.currentUser.name, details };
                        this.activityLog.unshift(logEntry);
                        if (this.activityLog.length > 200) this.activityLog.pop();
                        App.UI.triggerNotification(logEntry);
                    },

                    getAvailableRegions() {
                        const regions = this.locationsData.map(loc => loc.region);
                        return [...new Set(regions)];
                    },
                    
                    deleteItemRecursive(sourceData, parentId) {
                        const children = sourceData.filter(item => item.parent === parentId);
                        children.forEach(child => {
                            if (child.type === 'folder') {
                                this.deleteItemRecursive(sourceData, child.id);
                            }
                        });
                        const indicesToRemove = sourceData.map((item, index) => (item.parent === parentId || item.id === parentId) ? index : -1).filter(index => index !== -1);
                        for (let i = indicesToRemove.length - 1; i >= 0; i--) {
                            sourceData.splice(indicesToRemove[i], 1);
                        }
                    },
                    
                    _getDataSource(context) {
                        switch(context) {
                            case 'models': return { source: this.modelsData, path: App.state.currentModelPath, page: 'models-page', rootName: 'Ø§Ù„Ù†Ù…Ø§Ø°Ø¬' };
                            case 'buildingModels': return { source: this.buildingModelsData, path: App.state.currentBuildingModelPath, page: 'building-models-sub', rootName: 'Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ' };
                            case 'itemIllustrations': return { source: this.itemIllustrationsData, path: App.state.currentItemIllustrationPath, page: 'item-illustrations-page', rootName: 'Ø§Ù„Ø±Ø³ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠØ©' };
                            case 'itemAnalysis': return { source: this.itemAnalysisData, path: App.state.currentItemAnalysisPath, page: 'item-analysis-page', rootName: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù†Ø¯' };
                            case 'attachments': return { source: this.attachmentsData, path: App.state.currentAttachmentsPath, page: 'attachments-page', rootName: 'Ø§Ù„Ù…Ù„Ø­Ù‚Ø§Øª' };
                            case 'mandatoryList': return { source: this.mandatoryListData, path: App.state.currentMandatoryListPath, page: 'mandatory-list-page', rootName: 'Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠØ©' };
                            case 'localContent': return { source: this.localContentData, path: App.state.currentLocalContentPath, page: 'local-content-page', rootName: 'Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø­Ù„ÙŠ' };
                            default: return null;
                        }
                    }
                },

                // --- UI RENDERING ---
                // All functions that manipulate the DOM and render HTML.
                UI: {
                    showPage(pageId) {
                        if (!pageId) return;
                        App.DOM.pages.forEach(page => page?.classList.add('hidden'));
                        const targetPage = document.getElementById(pageId);
                        if (targetPage) {
                            targetPage.classList.remove('hidden');
                        } else {
                            console.error(`Page with id "${pageId}" not found. Showing home page.`);
                            document.getElementById('home')?.classList.remove('hidden');
                            return;
                        }
                        
                        // Call the specific render function for the page
                        const renderFunction = this.pageRenderers[pageId];
                        if (renderFunction) {
                            renderFunction();
                        }

                        // Update sidebar active link and page title
                        document.querySelectorAll('.nav-link, .nav-parent-button').forEach(el => el.classList.remove('active'));
                        const activeLink = Array.from(document.querySelectorAll('.nav-link')).find(link => link.dataset.page === pageId);
                        if (activeLink) {
                            activeLink.classList.add('active');
                            App.DOM.pageTitle.textContent = activeLink.textContent.trim();
                            const parentSubMenu = activeLink.closest('.submenu');
                            if (parentSubMenu) document.getElementById('studies-dropdown-toggle')?.classList.add('active');
                            if (activeLink.closest('#projects-dropdown-menu')) document.getElementById('projects-dropdown-toggle')?.classList.add('active');
                        } else if (targetPage) {
                             App.DOM.pageTitle.textContent = targetPage.querySelector('h2')?.textContent.trim() || pageId;
                        }

                        if (window.innerWidth < 768) App.DOM.sidebar?.classList.add('translate-x-full');
                    },

                    // A map of page IDs to their rendering functions
                    pageRenderers: {
                        'home': () => {
                            document.getElementById('home-user-name').textContent = App.state.currentUser.name;
                            document.getElementById('home-user-role').textContent = App.state.currentUser.role;
                        },
                        'dashboard': () => App.UI.renderDashboard(),
                        'projects-sub': () => App.UI.renderSummaryCards(),
                        'tendering-sub': () => App.UI.renderStagedProjects(),
                        'database-specs-sub': () => {}, // No specific render needed, it's a container for cards
                        'karrasa-page': () => {}, //App.UI.showKarrasaListView(),
                        'boq-items-page': () => {}, //App.UI.renderBoqItemsTable(),
                        'boq-templates-page': () => {}, //App.UI.showBoqTemplatesListView(),
                        'models-page': () => App.UI.renderFolderViewer('models-page', App.DB.modelsData, App.state.currentModelPath, 'Ø§Ù„Ù†Ù…Ø§Ø°Ø¬', 'models'),
                        'building-models-sub': () => App.UI.renderFolderViewer('building-models-sub', App.DB.buildingModelsData, App.state.currentBuildingModelPath, 'Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ', 'buildingModels'),
                        'regions-page': () => App.UI.renderRegionsPage(),
                        'suppliers-page': () => App.UI.renderSuppliersPage(),
                        'materials-page': () => App.UI.renderMaterialsPage(),
                        'samples-page': () => App.UI.renderSamplesPage(),
                        'item-illustrations-page': () => App.UI.renderFolderViewer('item-illustrations-page', App.DB.itemIllustrationsData, App.state.currentItemIllustrationPath, 'Ø§Ù„Ø±Ø³ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠØ©', 'itemIllustrations'),
                        'item-analysis-page': () => App.UI.renderFolderViewer('item-analysis-page', App.DB.itemAnalysisData, App.state.currentItemAnalysisPath, 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù†Ø¯', 'itemAnalysis'),
                        'attachments-page': () => App.UI.renderFolderViewer('attachments-page', App.DB.attachmentsData, App.state.currentAttachmentsPath, 'Ø§Ù„Ù…Ù„Ø­Ù‚Ø§Øª', 'attachments'),
                        'mandatory-list-page': () => App.UI.renderFolderViewer('mandatory-list-page', App.DB.mandatoryListData, App.state.currentMandatoryListPath, 'Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠØ©', 'mandatoryList'),
                        'local-content-page': () => App.UI.renderFolderViewer('local-content-page', App.DB.localContentData, App.state.currentLocalContentPath, 'Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø­Ù„ÙŠ', 'localContent'),
                        'archive': () => App.UI.renderArchivePage(),
                        'notifications-log': () => App.UI.renderNotificationsLogPage(),
                    },
                    
                    renderDashboard() {
                        const projects = App.DB.projects;
                        document.getElementById('kpi-total').textContent = projects.length;
                        document.getElementById('kpi-ongoing').textContent = projects.filter(p => p.status === 'Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø·Ø±Ø­').length;
                        document.getElementById('kpi-previous').textContent = projects.filter(p => p.status === 'Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©').length;
                        document.getElementById('kpi-proposed').textContent = projects.filter(p => p.status === 'Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©').length;

                        const barCtx = document.getElementById('barChart').getContext('2d');
                        const regionData = projects.reduce((acc, p) => ({ ...acc, [p.region]: (acc[p.region] || 0) + 1 }), {});
                        if (App.state.barChart) App.state.barChart.destroy();
                        App.state.barChart = new Chart(barCtx, { type: 'bar', data: { labels: Object.keys(regionData), datasets: [{ label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹', data: Object.values(regionData), backgroundColor: ['#3D4A3A', '#DAA520', '#6F7D6B', '#F2E3B3', '#4B5563', '#8E805B'], borderWidth: 1 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } } } });
                        
                        const ongoingProjectsContainer = document.getElementById('ongoing-projects-summary-container');
                        const averageContainer = document.getElementById('average-completion-container');
                        const ongoingProjects = projects.filter(p => p.status === 'Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø·Ø±Ø­');
                        
                        if(ongoingProjects.length > 0) {
                            const averageCompletion = ongoingProjects.reduce((sum, p) => sum + p.completion, 0) / ongoingProjects.length;
                            const circumference = 2 * Math.PI * 54;
                            averageContainer.innerHTML = `
                                <div class="relative w-40 h-40">
                                    <svg class="w-full h-full" viewBox="0 0 120 120">
                                        <circle class="text-gray-200" stroke-width="12" stroke="currentColor" fill="transparent" r="54" cx="60" cy="60" />
                                        <circle class="text-blue-600" stroke-width="12" stroke-dasharray="${circumference}" stroke-dashoffset="${circumference - (averageCompletion / 100) * circumference}" stroke-linecap="round" stroke="currentColor" fill="transparent" r="54" cx="60" cy="60" transform="rotate(-90 60 60)" style="transition: stroke-dashoffset 0.8s ease-out;"/>
                                    </svg>
                                    <div class="absolute inset-0 flex flex-col items-center justify-center">
                                         <span class="text-3xl font-bold" style="color: var(--olive-dark);">${Math.round(averageCompletion)}%</span>
                                         <span class="text-xs text-gray-500">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</span>
                                    </div>
                                </div>`;
                            ongoingProjectsContainer.innerHTML = ongoingProjects.map(p => `
                                    <div>
                                        <div class="flex justify-between items-center mb-1">
                                            <span class="text-sm font-medium text-gray-700">${p.name}</span>
                                            <span class="text-sm font-bold" style="color: var(--olive-dark);">${p.completion}%</span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2.5"><div class="h-2.5 rounded-full ${p.completion >= 100 ? 'bg-green-500' : 'bg-blue-600'}" style="width: ${p.completion}%;"></div></div>
                                    </div>`).join('');
                        } else {
                            averageContainer.innerHTML = '';
                            ongoingProjectsContainer.innerHTML = '<p class="text-center text-gray-500 py-8">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø·Ø±Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹.</p>';
                        }
                    },
                    
                    renderSummaryCards() {
                        document.getElementById('filtered-project-view').classList.add('hidden');
                        document.getElementById('document-list-view').classList.add('hidden');
                        const container = document.getElementById('project-summary-cards');
                        container.classList.remove('hidden');
                        const statuses = { 
                            "Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©": { count: App.DB.projects.filter(p=>p.status==='Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©').length, icon: 'ğŸ“œ' }, 
                            "Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø·Ø±Ø­": { count: App.DB.projects.filter(p=>p.status==='Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø·Ø±Ø­').length, icon: 'â³' }, 
                            "Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©": { count: App.DB.projects.filter(p=>p.status==='Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©').length, icon: 'ğŸ’¡' },
                            "Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¬Ø§Ø±ÙŠ Ø¯Ø±Ø§Ø³ØªÙ‡Ø§": { count: App.DB.projects.filter(p => p.status === 'Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¬Ø§Ø±ÙŠ Ø¯Ø±Ø§Ø³ØªÙ‡Ø§').length, icon: 'ğŸ§' },
                            "Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©": { count: App.DB.projects.filter(p => p.status === 'Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©').length, icon: 'ğŸ—“ï¸' }
                        };
                        container.innerHTML = Object.entries(statuses).map(([status, data]) => `<div class="summary-card cursor-pointer bg-white p-6 rounded-xl shadow-lg" data-status="${status}"><div class="flex items-center"><span class="text-3xl">${data.icon}</span><h3 class="font-bold text-xl mr-4">${status}</h3></div><p class="text-4xl font-bold mt-2">${data.count} <span class="text-lg">Ù…Ø´Ø±ÙˆØ¹</span></p></div>`).join('');
                    },

                    renderProjectDetails() { 
                        const container = document.getElementById('project-details-container'); 
                        container.innerHTML = ''; 
                        const term = document.getElementById('details-search-filter').value.toLowerCase(); 
                        const projectHasMatchingDoc = (project, term) => project.docs.some(docId => App.DB.documentArchive.find(d => d.id === docId)?.name.toLowerCase().includes(term));
                        
                        Object.keys(App.DB.meta.projTypeMeta).forEach(projTypeKey => { 
                            const meta = App.DB.meta.projTypeMeta[projTypeKey]; 
                            const filteredProjects = App.DB.projects.filter(p => p.status === App.state.currentProjectStatus && p.type === projTypeKey && (App.state.currentRegion === 'all' || p.region === App.state.currentRegion) && (term === '' || p.name.toLowerCase().includes(term) || projectHasMatchingDoc(p, term))); 
                            
                            const projectsHtml = filteredProjects.length > 0 ? filteredProjects.map(project => { 
                                const docsHtml = Object.keys(App.DB.meta.docTypeMeta).map(docTypeKey => {
                                    const docCount = project.docs.filter(docId => App.DB.documentArchive.find(d => d.id === docId)?.type === docTypeKey).length;
                                    return `<div class="bg-gray-50 p-3 rounded-lg"><h5 class="font-semibold">${App.DB.meta.docTypeMeta[docTypeKey].icon} ${App.DB.meta.docTypeMeta[docTypeKey].name} (${docCount})</h5><div class="mt-2 flex justify-between items-center"><button class="view-doc-list-btn text-sm text-blue-600" data-project-id="${project.id}" data-doc-type="${docTypeKey}">Ø¹Ø±Ø¶</button><button class="add-file-to-project-btn bg-green-100 text-green-700 rounded-full w-7 h-7 text-lg" data-project-id="${project.id}" data-doc-type="${docTypeKey}">+</button></div></div>`; 
                                }).join('');
                                return `<div class="project-accordion-item bg-white rounded-lg shadow-sm"><button class="project-accordion-toggle w-full p-4 flex justify-between items-center text-right font-semibold"><span>${project.name} (${project.region})</span><svg class="w-5 h-5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button><div class="project-accordion-content hidden p-4 border-t grid grid-cols-2 lg:grid-cols-4 gap-3">${docsHtml}</div></div>`; 
                            }).join('') : `<div class="text-center text-gray-500 p-4 bg-gray-50 rounded-lg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØ¦Ø©.</div>`; 
                            
                            container.innerHTML += `<div class="proj-type-accordion-item bg-white rounded-xl shadow-lg overflow-hidden"><button class="proj-type-accordion-toggle p-4 cursor-pointer flex justify-between items-center font-bold text-lg w-full">${meta.icon}<span class="mr-3">${meta.name}</span><svg class="w-6 h-6 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button><div class="proj-type-accordion-content hidden p-2 space-y-2 bg-gray-50">${projectsHtml}</div></div>`; 
                        }); 
                    },

                    renderRegionsPage() {
                        const tableBody = document.getElementById('locations-table-body');
                        if (!tableBody) return;
                        tableBody.innerHTML = App.DB.locationsData.map(loc => `
                            <tr>
                                <td>${loc.region}</td>
                                <td>${loc.governorate}</td>
                                <td>${loc.center}</td>
                                <td class="space-x-2 space-x-reverse whitespace-nowrap">
                                    <button class="edit-location-btn text-blue-600 hover:text-blue-800" data-id="${loc.id}">ØªØ¹Ø¯ÙŠÙ„</button>
                                    <button class="delete-location-btn text-red-600 hover:text-red-800" data-id="${loc.id}">Ø­Ø°Ù</button>
                                </td>
                            </tr>
                        `).join('');
                    },

                    renderSuppliersPage() {
                        const tableBody = document.getElementById('suppliers-table-body');
                        if (!tableBody) return;
                        tableBody.innerHTML = App.DB.suppliersData.map(sup => `
                            <tr>
                                <td>${sup.name}</td>
                                <td>${sup.type}</td>
                                <td>${sup.city}</td>
                                <td>${sup.phone}</td>
                                <td>${sup.email}</td>
                                <td class="text-yellow-500 text-lg">${'â˜…'.repeat(sup.rating)}${'â˜†'.repeat(5 - sup.rating)}</td>
                                <td><button class="view-supplier-files-btn text-blue-600 hover:text-blue-800" data-id="${sup.id}">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª (${sup.files.length})</button></td>
                                <td class="space-x-2 space-x-reverse whitespace-nowrap">
                                    <button class="edit-supplier-btn text-blue-600 hover:text-blue-800" data-id="${sup.id}">ØªØ¹Ø¯ÙŠÙ„</button>
                                    <button class="delete-supplier-btn text-red-600 hover:text-red-800" data-id="${sup.id}">Ø­Ø°Ù</button>
                                </td>
                            </tr>
                        `).join('');
                    },
                    
                    renderMaterialsPage() {
                        const tableBody = document.getElementById('materials-table-body');
                        if (!tableBody) return;
                        tableBody.innerHTML = App.DB.materialsData.map(mat => {
                            const supplier = App.DB.suppliersData.find(s => s.id == mat.supplierId);
                            return `
                            <tr>
                                <td>${mat.name}</td>
                                <td class="whitespace-normal">${mat.specs}</td>
                                <td>${supplier ? supplier.name : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                                <td>${mat.price.toFixed(2)} Ø±ÙŠØ§Ù„</td>
                                <td class="space-x-2 space-x-reverse whitespace-nowrap">
                                    <button class="edit-material-btn text-blue-600 hover:text-blue-800" data-id="${mat.id}">ØªØ¹Ø¯ÙŠÙ„</button>
                                    <button class="delete-material-btn text-red-600 hover:text-red-800" data-id="${mat.id}">Ø­Ø°Ù</button>
                                </td>
                            </tr>
                        `}).join('');
                    },

                    renderSamplesPage() {
                        const tableBody = document.getElementById('samples-table-body');
                        if (!tableBody) return;
                        const statusClasses = {
                            'Ù…Ø¹ØªÙ…Ø¯Ø©': 'status-approved',
                            'Ù…Ø±ÙÙˆØ¶Ø©': 'status-rejected',
                            'ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©': 'status-pending'
                        };
                        tableBody.innerHTML = App.DB.samplesData.map(sample => {
                            const project = App.DB.projects.find(p => p.id === sample.projectId);
                            const supplier = App.DB.suppliersData.find(s => s.id === sample.supplierId);
                            return `
                                <tr>
                                    <td>${sample.name}</td>
                                    <td>${project ? project.name : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                                    <td>${supplier ? supplier.name : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                                    <td>${new Date(sample.submissionDate).toLocaleDateString('ar-EG')}</td>
                                    <td><span class="status-badge ${statusClasses[sample.status] || ''}">${sample.status}</span></td>
                                    <td class="space-x-2 space-x-reverse whitespace-nowrap">
                                        <button class="edit-sample-btn text-blue-600 hover:text-blue-800" data-id="${sample.id}">ØªØ¹Ø¯ÙŠÙ„/Ø¹Ø±Ø¶</button>
                                        <button class="delete-sample-btn text-red-600 hover:text-red-800" data-id="${sample.id}">Ø­Ø°Ù</button>
                                    </td>
                                </tr>
                            `;
                        }).join('');
                    },
                    
                    renderArchivePage(searchTerm = '') {
                        const tableBody = document.getElementById('archive-table-body'); if (!tableBody) return; const lowerCaseSearchTerm = searchTerm.toLowerCase();
                        const filteredDocs = App.DB.documentArchive.filter(doc => { const project = App.DB.projects.find(p => p.id === doc.projectId); return doc.name.toLowerCase().includes(lowerCaseSearchTerm) || doc.addedBy.toLowerCase().includes(lowerCaseSearchTerm) || (project && (project.name.toLowerCase().includes(lowerCaseSearchTerm) || project.status.toLowerCase().includes(lowerCaseSearchTerm))); });
                        tableBody.innerHTML = filteredDocs.length ? filteredDocs.map(doc => { const project = App.DB.projects.find(p => p.id === doc.projectId); const projectName = project?.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'; const projectStatus = project?.status || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'; const formattedDate = new Date(doc.addedDate).toLocaleDateString('ar-EG-u-nu-latn', { year: 'numeric', month: 'long', day: 'numeric' }); return `<tr><td>${doc.name}</td><td>${projectName}</td><td>${projectStatus}</td><td>${doc.addedBy}</td><td>${formattedDate}</td><td class="space-x-2 space-x-reverse whitespace-nowrap"><button class="view-doc-archive text-blue-600 hover:text-blue-800" data-doc-id="${doc.id}">Ø¹Ø±Ø¶</button><button class="download-doc-archive text-green-600 hover:text-green-800" data-doc-id="${doc.id}">ØªØ­Ù…ÙŠÙ„</button></td></tr>`; }).join('') : `<tr><td colspan="6" class="text-center p-4 text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³ØªÙ†Ø¯Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¨Ø­Ø«.</td></tr>`;
                    },

                    renderNotificationsLogPage(searchTerm = '') {
                        const tableBody = document.getElementById('notifications-log-table-body'); if (!tableBody) return; const lowerCaseSearchTerm = searchTerm.toLowerCase();
                        const filteredLogs = App.DB.activityLog.filter(log => Object.values(log).some(value => value.toString().toLowerCase().includes(lowerCaseSearchTerm)));
                        tableBody.innerHTML = filteredLogs.length ? filteredLogs.map(log => { const formattedDate = new Date(log.date).toLocaleString('ar-EG', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' }); return `<tr><td>${formattedDate}</td><td>${log.section}</td><td class="whitespace-normal">${log.item}</td><td>${log.action}</td><td>${log.user}</td><td class="whitespace-normal">${log.details}</td></tr>`; }).join('') : `<tr><td colspan="6" class="text-center p-4 text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª.</td></tr>`;
                    },

                    renderFolderViewer(containerId, sourceData, path, rootName, context) {
                        const container = document.getElementById(containerId);
                        if (!container) return;
                        const currentFolderId = path[path.length - 1];
                        const items = sourceData.filter(item => item.parent === currentFolderId);
                        
                        const breadcrumbs = path.map((folderId, index) => {
                            if (folderId === null) {
                                return `<button class="breadcrumb-btn" data-index="${index}" data-context="${context}">${rootName}</button>`;
                            }
                            const folder = sourceData.find(f => f.id === folderId);
                            return `<span class="mx-2">/</span><button class="breadcrumb-btn" data-index="${index}" data-context="${context}">${folder ? folder.name : '...'}</button>`;
                        }).join('');

                        const foldersHTML = items.filter(i => i.type === 'folder').map(folder => `
                            <div class="folder-item flex items-center p-3 bg-white rounded-lg shadow-sm cursor-pointer hover:bg-yellow-50" data-id="${folder.id}" data-context="${context}">
                                <button class="delete-item-btn" data-id="${folder.id}" data-type="folder" data-context="${context}">Ã—</button>
                                <span class="text-3xl">ğŸ“</span>
                                <span class="mr-4 font-semibold">${folder.name}</span>
                            </div>
                        `).join('');

                        const filesHTML = items.filter(i => i.type === 'file').map(file => `
                            <div class="file-item flex items-center p-3 bg-white rounded-lg shadow-sm cursor-pointer hover:bg-gray-50" data-id="${file.id}" data-context="${context}">
                                <button class="delete-item-btn" data-id="${file.id}" data-type="file" data-context="${context}">Ã—</button>
                                <span class="text-2xl">${App.utils.getFileIcon(file.fileType)}</span>
                                <span class="mr-4">${file.name}</span>
                            </div>
                        `).join('');
                        
                        const backButtonHTML = `<button class="back-to-database-specs bg-gray-800 text-white text-sm rounded-lg px-4 py-2 hover:bg-black transition-colors mr-2">â†’ Ø§Ù„Ø±Ø¬ÙˆØ¹</button>`;

                        container.innerHTML = `
                            <div class="flex justify-between items-center mb-6">
                                <nav class="flex items-center text-lg font-bold">${breadcrumbs}</nav>
                                <div>
                                    <button class="add-folder-btn bg-blue-600 text-white text-sm rounded-lg px-4 py-2 hover:bg-blue-700 transition-colors" data-context="${context}"><span>+</span> Ø¥Ø¶Ø§ÙØ© Ù…Ø¬Ù„Ø¯</button>
                                    <button class="add-model-file-btn bg-green-600 text-white text-sm rounded-lg px-4 py-2 hover:bg-green-700 transition-colors mr-2" data-context="${context}"><span>+</span> Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ù</button>
                                    ${backButtonHTML}
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                ${foldersHTML}
                                ${filesHTML}
                            </div>
                        `;
                    },

                    renderStagedProjects() {
                        const container = document.getElementById('staged-projects-container');
                        const noProjectsMsg = document.getElementById('no-staged-projects-msg');
                        const projects = App.DB.stagedProjects;

                        if (!container || !noProjectsMsg) return;

                        if (projects.length === 0) {
                            container.innerHTML = '';
                            noProjectsMsg.classList.remove('hidden');
                        } else {
                            noProjectsMsg.classList.add('hidden');
                            container.innerHTML = projects.map(proj => {
                                const docTypes = App.DB.meta.docTypeMeta;
                                const docsHtml = Object.keys(docTypes).map(key => `
                                    <div class="mb-3">
                                        <h5 class="font-semibold text-sm mb-2">${docTypes[key].icon} ${docTypes[key].name}</h5>
                                        <div class="staged-docs-container p-2 rounded-lg min-h-[50px]">
                                            ${proj.docs[key] && proj.docs[key].length > 0
                                                ? proj.docs[key].map(doc => `<div class="staged-file-preview">${doc.name}</div>`).join('')
                                                : `<p class="text-xs text-gray-400 p-2">Ù„Ù… ÙŠØªÙ… Ø¥Ø±ÙØ§Ù‚ Ù…Ù„ÙØ§Øª.</p>`
                                            }
                                        </div>
                                        <button class="add-staged-doc-btn mt-2 text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded hover:bg-blue-200" data-project-id="${proj.id}" data-doc-type="${key}">+ Ø¥Ø¶Ø§ÙØ©</button>
                                    </div>
                                `).join('');

                                return `
                                <div class="staged-project-accordion" data-id="${proj.id}">
                                    <button class="staged-project-accordion-toggle ${proj.status === 'tendered' ? 'tendered' : 'proposed'}">
                                        <div class="text-right flex-grow">
                                            <h4 class="font-bold text-lg">${proj.name}</h4>
                                            <p class="text-sm">${proj.region} - ${proj.type}</p>
                                        </div>
                                        <div class="flex items-center gap-4 flex-shrink-0 ml-4">
                                            <div class="text-center">
                                                <span class="text-xs font-semibold">Ø§Ù„Ø­Ø§Ù„Ø©</span>
                                                <p class="font-bold">${proj.status === 'tendered' ? 'ØªÙ… Ø·Ø±Ø­Ù‡' : 'Ù…Ù‚ØªØ±Ø­'}</p>
                                            </div>
                                            <svg class="w-6 h-6 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                        </div>
                                    </button>
                                    <div class="staged-project-accordion-content hidden p-6 bg-white border-t">
                                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                            ${docsHtml}
                                        </div>
                                        <div class="mt-6 pt-4 border-t flex justify-end items-center flex-wrap gap-3">
                                            <button class="remove-staged-project-btn bg-red-100 text-red-700 text-sm font-bold py-2 px-4 rounded-lg hover:bg-red-200 transition-colors" data-id="${proj.id}">Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„ØªØ­Ø¶ÙŠØ±</button>
                                            <button class="update-project-status-btn bg-gray-200 text-gray-800 text-sm font-bold py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors flex items-center gap-2" data-id="${proj.id}" data-status="Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©"><span>ğŸ’¡</span> Ù…Ø´Ø±ÙˆØ¹ Ù…Ù‚ØªØ±Ø­</button>
                                            <button class="update-project-status-btn bg-gray-200 text-gray-800 text-sm font-bold py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors flex items-center gap-2" data-id="${proj.id}" data-status="Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¬Ø§Ø±ÙŠ Ø¯Ø±Ø§Ø³ØªÙ‡Ø§"><span>ğŸ§</span> Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø§Ø±ÙŠ Ø¯Ø±Ø§Ø³ØªÙ‡</button>
                                            <button class="update-project-status-btn bg-gray-200 text-gray-800 text-sm font-bold py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors flex items-center gap-2" data-id="${proj.id}" data-status="Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©"><span>ğŸ—“ï¸</span> Ù…Ø´Ø±ÙˆØ¹ Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠ</button>
                                            <button class="tender-project-btn bg-green-600 text-white text-sm font-bold py-2 px-5 rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2" data-id="${proj.id}"><span>ğŸš€</span> Ø·Ø±Ø­ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</button>
                                        </div>
                                    </div>
                                </div>`;
                            }).join('');
                        }
                    },
                    
                    // --- MODAL & NOTIFICATION UI ---
                    showMessageModal(title, text, icon = 'â„¹ï¸', iconBgColor = 'bg-blue-100') {
                        const modal = document.getElementById('messageModal');
                        if (!modal) return;
                        modal.querySelector('#messageModalTitle').textContent = title;
                        modal.querySelector('#messageModalText').innerHTML = text;
                        const iconEl = modal.querySelector('#messageModalIcon');
                        iconEl.textContent = icon;
                        iconEl.className = `w-16 h-16 rounded-full mx-auto flex items-center justify-center text-3xl mb-4 ${iconBgColor}`;
                        modal.classList.remove('hidden');
                        const closeBtn = modal.querySelector('#messageModalCloseBtn');
                        closeBtn.replaceWith(closeBtn.cloneNode(true));
                        document.getElementById('messageModalCloseBtn').addEventListener('click', () => modal.classList.add('hidden'));
                    },

                    triggerNotification(log) {
                        if (!App.DOM.notificationBell || !App.DOM.notificationIndicator || !App.DOM.notificationsList) return;
                        App.utils.synth.triggerAttackRelease("C5", "8n");
                        App.DOM.notificationBell.classList.add('jiggle');
                        setTimeout(() => App.DOM.notificationBell.classList.remove('jiggle'), 600);
                        App.DOM.notificationIndicator.classList.remove('hidden');
                        const listItem = document.createElement('a');
                        listItem.href = "#";
                        listItem.className = "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100";
                        listItem.innerHTML = `<p class="font-bold">${log.section}: ${log.action}</p><p class="text-xs text-gray-500">${log.item}</p>`;
                        App.DOM.notificationsList.insertBefore(listItem, App.DOM.notificationsList.firstChild);
                        if (App.DOM.notificationsList.children.length > 5) {
                            App.DOM.notificationsList.removeChild(App.DOM.notificationsList.lastChild);
                        }
                    },
                    
                    openAddFolderModal(context) {
                        const modal = document.getElementById('addFolderModal');
                        modal.dataset.context = context;
                        modal.classList.remove('hidden');
                        document.getElementById('addFolderForm').reset();
                    },

                    openAddFileModal(context) { 
                        App.state.currentAddFileContext = context;
                        const modal = document.getElementById('addFileModal'); 
                        let title = 'Ø¥Ø±ÙØ§Ù‚ Ù…Ù„ÙØ§Øª';
                        if (context.destination === 'project') {
                            title = `Ø¥Ø±ÙØ§Ù‚ Ù…Ù„ÙØ§Øª Ù„Ù€: ${App.DB.meta.docTypeMeta[context.docType].name}`;
                        } else if (context.destination === 'stagedProject') {
                             const project = App.DB.stagedProjects.find(p => p.id == context.projectId);
                             title = `Ø¥Ø±ÙØ§Ù‚ Ù…Ù„ÙØ§Øª Ù„Ù€: ${project.name} (${App.DB.meta.docTypeMeta[context.docType].name})`;
                        } else if (context.destination === 'models') {
                            title = 'Ø¥Ø±ÙØ§Ù‚ Ù…Ù„ÙØ§Øª Ù„Ù„Ù†Ù…Ø§Ø°Ø¬';
                        } else if (context.destination === 'buildingModels') {
                            title = 'Ø¥Ø±ÙØ§Ù‚ Ù…Ù„ÙØ§Øª Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ';
                        } else if (context.destination === 'itemIllustrations') {
                            title = 'Ø¥Ø±ÙØ§Ù‚ Ø±Ø³ÙˆÙ…Ø§Øª ØªÙˆØ¶ÙŠØ­ÙŠØ©';
                        } else if (context.destination === 'supplier') {
                            const supplier = App.DB.suppliersData.find(s => s.id == context.supplierId);
                            title = `Ø¥Ø±ÙØ§Ù‚ Ù…Ù„ÙØ§Øª Ù„Ù„Ù…ÙˆØ±Ø¯: ${supplier.name}`;
                        }
                        modal.querySelector('#addFileModalTitle').textContent = title; 
                        modal.querySelector('#attachFileInput').value = ''; 
                        modal.querySelector('#file-preview-list').innerHTML = ''; 
                        modal.classList.remove('hidden'); 
                    },

                    viewFileObject(fileObject) {
                        const modal = document.getElementById('documentViewModal');
                        const viewer = document.getElementById('document-viewer-content');
                        const title = document.getElementById('document-view-title');
                        const downloadBtn = document.getElementById('downloadDocumentBtn');
                        
                        title.textContent = fileObject.name;
                        viewer.innerHTML = '';
                        
                        downloadBtn.onclick = () => {
                            if (!fileObject.content) {
                                this.showMessageModal('Ø®Ø·Ø£', 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ Ù„ØªØ­Ù…ÙŠÙ„Ù‡.', 'âš ï¸', 'bg-yellow-100');
                                return;
                            }
                            const a = document.createElement('a');
                            a.href = fileObject.content;
                            a.download = fileObject.name;
                            document.body.appendChild(a);
                            a.click();
                            document.body.removeChild(a);
                        };

                        if (!fileObject.content) {
                            viewer.innerHTML = `<div class="text-center p-8"><span class="text-6xl">${App.utils.getFileIcon(fileObject.fileType)}</span><p class="text-lg font-semibold text-gray-700 mt-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§ÙŠÙ†Ø© Ù„Ù„Ù…Ù„Ù.</p><p class="text-gray-500 mt-1">ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ù„Ø¹Ø±Ø¶Ù‡.</p></div>`;
                        } else if (fileObject.fileType.startsWith('image/')) {
                            viewer.innerHTML = `<img src="${fileObject.content}" alt="${fileObject.name}" class="max-w-full h-auto rounded-lg mx-auto">`;
                        } else {
                            viewer.innerHTML = `<div class="text-center p-8"><span class="text-6xl">${App.utils.getFileIcon(fileObject.fileType)}</span><p class="text-lg font-semibold text-gray-700 mt-4">Ù„Ø§ ØªØªÙˆÙØ± Ù…Ø¹Ø§ÙŠÙ†Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª.</p><p class="text-gray-500 mt-2">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù: ${fileObject.fileType || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</p></div>`;
                        }
                        modal.classList.remove('hidden');
                    }
                },

                // --- EVENT HANDLERS & LOGIC ---
                // All business logic and event handling functions.
                handlers: {
                    handleSummaryCardClick(status) { 
                        App.state.currentProjectStatus = status; 
                        document.getElementById('project-summary-cards').classList.add('hidden'); 
                        document.getElementById('filtered-project-view').classList.remove('hidden'); 
                        document.getElementById('filtered-project-title').textContent = App.state.currentProjectStatus; 
                        // App.UI.renderRegionFilters('detail-region-filter'); 
                        App.UI.renderProjectDetails(); 
                    },
                    handleFolderViewerInteraction(e) {
                        e.stopPropagation();
                        const target = e.currentTarget;
                        const context = target.dataset.context;
                        const ds = App.DB._getDataSource(context);
                        if (!ds) return;

                        if (target.classList.contains('breadcrumb-btn')) {
                            const index = parseInt(target.dataset.index);
                            ds.path.splice(index + 1);
                        } else if (target.classList.contains('folder-item')) {
                            ds.path.push(target.dataset.id);
                        } else if (target.classList.contains('file-item')) {
                            const file = ds.source.find(f => f.id === target.dataset.id);
                            if (file) App.UI.viewFileObject(file);
                            return;
                        } else if (target.classList.contains('add-folder-btn')) {
                            App.UI.openAddFolderModal(context);
                            return;
                        } else if (target.classList.contains('add-model-file-btn')) {
                            App.UI.openAddFileModal({ destination: context });
                            return;
                        } else if (target.classList.contains('delete-item-btn')) {
                            const itemId = target.dataset.id;
                            const itemType = target.dataset.type;
                            const item = ds.source.find(i => i.id === itemId);
                            
                            const confirmationModal = document.getElementById('confirmationModal');
                            confirmationModal.querySelector('#confirmationModalTitle').textContent = 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù';
                            confirmationModal.querySelector('#confirmationModalText').textContent = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${itemType === 'folder' ? 'Ø§Ù„Ù…Ø¬Ù„Ø¯' : 'Ø§Ù„Ù…Ù„Ù'}: "${item.name}"ØŸ ${itemType === 'folder' ? 'Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ù…Ø­ØªÙˆÙŠØ§ØªÙ‡.' : ''}`;
                            confirmationModal.classList.remove('hidden');
                            
                            const confirmBtn = document.getElementById('confirmDeleteBtn');
                            confirmBtn.replaceWith(confirmBtn.cloneNode(true));
                            document.getElementById('confirmDeleteBtn').onclick = () => {
                                App.DB.deleteItemRecursive(ds.source, itemId);
                                App.DB.logActivity('Ø§Ù„Ù…Ù„ÙØ§Øª', item.name, 'Ø­Ø°Ù', `ØªÙ… Ø­Ø°Ù ${itemType}`);
                                App.UI.renderFolderViewer(ds.page, ds.source, ds.path, ds.rootName, context);
                                confirmationModal.classList.add('hidden');
                            };
                            return;
                        }
                        
                        App.UI.renderFolderViewer(ds.page, ds.source, ds.path, ds.rootName, context);
                    },
                    handleAddFolderSubmit(e) {
                        e.preventDefault();
                        const modal = e.target.closest('#addFolderModal');
                        const context = modal.dataset.context;
                        const folderName = document.getElementById('newFolderName').value.trim();
                        if (!folderName) return;

                        const ds = App.DB._getDataSource(context);
                        if (!ds) return;

                        const newFolder = {
                            id: `f-${Date.now()}`,
                            type: 'folder',
                            name: folderName,
                            parent: ds.path[ds.path.length - 1]
                        };

                        ds.source.push(newFolder);
                        App.DB.logActivity('Ø§Ù„Ù…Ù„ÙØ§Øª', folderName, 'Ø¥Ø¶Ø§ÙØ©', `ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ù…Ø¬Ù„Ø¯ Ø¬Ø¯ÙŠØ¯ ÙÙŠ ${ds.rootName}`);
                        App.UI.renderFolderViewer(ds.page, ds.source, ds.path, ds.rootName, context);
                        modal.classList.add('hidden');
                    },
                    handleAddFileSubmit(e) {
                        e.preventDefault();
                        const modal = e.target.closest('#addFileModal');
                        const context = App.state.currentAddFileContext;
                        const files = document.getElementById('attachFileInput').files;
                        if (files.length === 0) return;

                        if (context.destination === 'stagedProject') {
                            const project = App.DB.stagedProjects.find(p => p.id == context.projectId);
                            if (project) {
                                Array.from(files).forEach(file => {
                                    project.docs[context.docType].push({ name: file.name, file: file });
                                });
                                App.DB.logActivity('Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹', project.name, 'Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ù', `ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${files.length} Ù…Ù„ÙØ§Øª Ø¥Ù„Ù‰ ${App.DB.meta.docTypeMeta[context.docType].name}`);
                                App.UI.renderStagedProjects();
                            }
                        } else {
                            const ds = App.DB._getDataSource(context.destination);
                            if (!ds) return;
                            
                            Array.from(files).forEach(file => {
                                const newFile = {
                                    id: `file-${Date.now()}-${Math.random()}`,
                                    type: 'file',
                                    name: file.name,
                                    fileType: file.type,
                                    content: null, // In a real app, this would be uploaded and a URL stored
                                    parent: ds.path[ds.path.length - 1]
                                };
                                ds.source.push(newFile);
                                App.DB.logActivity('Ø§Ù„Ù…Ù„ÙØ§Øª', file.name, 'Ø¥Ø¶Ø§ÙØ©', `ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯ ÙÙŠ ${ds.rootName}`);
                            });
                            App.UI.renderFolderViewer(ds.page, ds.source, ds.path, ds.rootName, context.destination);
                        }
                        
                        modal.classList.add('hidden');
                    },
                    openSampleModal(sampleId = null) {
                        const modal = document.getElementById('addSampleModal');
                        const form = document.getElementById('addSampleForm');
                        form.reset();
                        document.getElementById('sampleId').value = sampleId || '';
                        document.getElementById('sampleModalTitle').textContent = sampleId ? 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹ÙŠÙ†Ø©' : 'Ø¥Ø¶Ø§ÙØ© Ø¹ÙŠÙ†Ø© Ø¬Ø¯ÙŠØ¯Ø©';

                        const projectSelect = document.getElementById('sampleProject');
                        projectSelect.innerHTML = App.DB.projects.map(p => `<option value="${p.id}">${p.name}</option>`).join('');

                        const supplierSelect = document.getElementById('sampleSupplier');
                        supplierSelect.innerHTML = App.DB.suppliersData.map(s => `<option value="${s.id}">${s.name}</option>`).join('');
                        
                        if (sampleId) {
                            const sample = App.DB.samplesData.find(s => s.id == sampleId);
                            if (sample) {
                                document.getElementById('sampleName').value = sample.name;
                                document.getElementById('sampleSubmissionDate').value = sample.submissionDate;
                                projectSelect.value = sample.projectId;
                                supplierSelect.value = sample.supplierId;
                                document.getElementById('sampleDescription').value = sample.description;
                                document.querySelector(`input[name="sampleStatus"][value="${sample.status}"]`).checked = true;
                                document.getElementById('sampleNotes').value = sample.notes;
                            }
                        } else {
                             document.querySelector(`input[name="sampleStatus"][value="ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©"]`).checked = true;
                        }

                        modal.classList.remove('hidden');
                    },
                    handleSampleFormSubmit(e) {
                        e.preventDefault();
                        const id = document.getElementById('sampleId').value;
                        const sampleData = {
                            name: document.getElementById('sampleName').value,
                            submissionDate: document.getElementById('sampleSubmissionDate').value,
                            projectId: parseInt(document.getElementById('sampleProject').value),
                            supplierId: parseInt(document.getElementById('sampleSupplier').value),
                            description: document.getElementById('sampleDescription').value,
                            status: document.querySelector('input[name="sampleStatus"]:checked').value,
                            notes: document.getElementById('sampleNotes').value,
                            files: [] // File handling to be implemented
                        };

                        if (id) {
                            const index = App.DB.samplesData.findIndex(s => s.id == id);
                            if (index !== -1) {
                                App.DB.samplesData[index] = { ...App.DB.samplesData[index], ...sampleData };
                            }
                        } else {
                            sampleData.id = Date.now();
                            App.DB.samplesData.push(sampleData);
                        }
                        
                        App.UI.renderSamplesPage();
                        document.getElementById('addSampleModal').classList.add('hidden');
                    },
                    handleDeleteSample(sampleId) {
                        const sample = App.DB.samplesData.find(s => s.id == sampleId);
                        if (!sample) return;
                        
                        const confirmationModal = document.getElementById('confirmationModal');
                        confirmationModal.querySelector('#confirmationModalTitle').textContent = 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù';
                        confirmationModal.querySelector('#confirmationModalText').textContent = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø¹ÙŠÙ†Ø©: "${sample.name}"ØŸ`;
                        confirmationModal.classList.remove('hidden');
                        
                        const confirmBtn = document.getElementById('confirmDeleteBtn');
                        confirmBtn.replaceWith(confirmBtn.cloneNode(true));
                        document.getElementById('confirmDeleteBtn').onclick = () => {
                            App.DB.samplesData = App.DB.samplesData.filter(s => s.id != sampleId);
                            App.DB.logActivity('Ø§Ù„Ø¹ÙŠÙ†Ø§Øª', sample.name, 'Ø­Ø°Ù', 'ØªÙ… Ø­Ø°Ù Ø³Ø¬Ù„ Ø§Ù„Ø¹ÙŠÙ†Ø©');
                            App.UI.renderSamplesPage();
                            confirmationModal.classList.add('hidden');
                        };
                    },
                    openAddStagedProjectModal() {
                        const modal = document.getElementById('addStagedProjectModal');
                        const listContainer = document.getElementById('staged-project-selection-list');
                        if (!modal || !listContainer) return;

                        const stagedProjectIds = App.DB.stagedProjects.map(p => p.id);
                        const eligibleProjects = App.DB.projects.filter(p => 
                            p.status === 'Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©' && !stagedProjectIds.includes(p.id)
                        );

                        if (eligibleProjects.length === 0) {
                            listContainer.innerHTML = '<p class="text-center text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ù‚ØªØ±Ø­Ø© Ù…ØªØ§Ø­Ø© Ù„Ù„Ø¥Ø¶Ø§ÙØ© Ø­Ø§Ù„ÙŠØ§Ù‹.</p>';
                        } else {
                            listContainer.innerHTML = eligibleProjects.map(p => `
                                <label class="flex items-center p-3 hover:bg-gray-100 rounded-lg cursor-pointer">
                                    <input type="checkbox" class="form-checkbox h-5 w-5 rounded text-yellow-600" data-project-id="${p.id}">
                                    <span class="mr-4">${p.name} <span class="text-sm text-gray-500">(${p.region})</span></span>
                                </label>
                            `).join('');
                        }

                        modal.classList.remove('hidden');
                    },
                    handleRemoveStagedProject(projectId) {
                        const project = App.DB.stagedProjects.find(p => p.id == projectId);
                        if (!project) return;
                        
                        const confirmationModal = document.getElementById('confirmationModal');
                        confirmationModal.querySelector('#confirmationModalTitle').textContent = 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø²Ø§Ù„Ø©';
                        confirmationModal.querySelector('#confirmationModalText').textContent = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø²Ø§Ù„Ø© Ù…Ø´Ø±ÙˆØ¹ "${project.name}" Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ­Ø¶ÙŠØ±ØŸ`;
                        confirmationModal.classList.remove('hidden');
                        
                        const confirmBtn = document.getElementById('confirmDeleteBtn');
                        confirmBtn.replaceWith(confirmBtn.cloneNode(true));
                        document.getElementById('confirmDeleteBtn').onclick = () => {
                            App.DB.stagedProjects = App.DB.stagedProjects.filter(p => p.id != projectId);
                            App.DB.logActivity('Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹', project.name, 'Ø¥Ø²Ø§Ù„Ø©', 'ØªÙ…Øª Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù…Ù† Ø§Ù„ØªØ­Ø¶ÙŠØ±');
                            App.UI.renderStagedProjects();
                            confirmationModal.classList.add('hidden');
                        };
                    },
                    handleUpdateProjectStatus(projectId, newStatus) {
                        const projectIndex = App.DB.projects.findIndex(p => p.id == projectId);
                        if (projectIndex === -1) return;
                        
                        const project = App.DB.projects[projectIndex];
                        const oldStatus = project.status;
                        project.status = newStatus;

                        App.DB.stagedProjects = App.DB.stagedProjects.filter(p => p.id != projectId);
                        
                        App.DB.logActivity('Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹', project.name, 'ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©', `ØªÙ… ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù…Ù† "${oldStatus}" Ø¥Ù„Ù‰ "${newStatus}"`);
                        App.UI.renderStagedProjects();
                        App.UI.showMessageModal('Ù†Ø¬Ø§Ø­', `ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ "${project.name}" Ø¨Ù†Ø¬Ø§Ø­.`, 'âœ…', 'bg-green-100');
                    },
                    handleTenderProject(projectId) {
                        this.handleUpdateProjectStatus(projectId, 'Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø·Ø±Ø­');
                    }
                },

                // --- INITIALIZATION ---
                init() {
                    // Cache DOM elements
                    this.DOM.pages = document.querySelectorAll('.page-content');
                    this.DOM.pageTitle = document.getElementById('page-title');
                    this.DOM.sidebar = document.getElementById('sidebar');
                    this.DOM.mainContent = document.getElementById('main-content');
                    this.DOM.notificationBell = document.getElementById('notification-bell');
                    this.DOM.notificationIndicator = document.getElementById('notification-indicator');
                    this.DOM.notificationsDropdown = document.getElementById('notifications-dropdown');
                    this.DOM.notificationsList = document.getElementById('notifications-list');

                    // Initialize data that depends on other App properties
                    this.DB.initData();

                    // Setup global event listeners using delegation
                    this.initEventListeners();

                    // Initial setup
                    this.DB.logActivity('Ø§Ù„Ù†Ø¸Ø§Ù…', 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'Ù…ØµØ§Ø¯Ù‚Ø©', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
                    this.UI.showPage('home');
                },

                initEventListeners() {
                    // Sidebar and navigation
                    document.getElementById('sidebar').addEventListener('click', e => {
                        const navLink = e.target.closest('.nav-link');
                        const parentBtn = e.target.closest('.nav-parent-button');
                        if (navLink) {
                            e.preventDefault();
                            this.UI.showPage(navLink.dataset.page);
                        }
                        if (parentBtn) {
                            parentBtn.nextElementSibling?.classList.toggle('hidden');
                            parentBtn.querySelector('svg')?.classList.toggle('rotate-180');
                        }
                    });

                    // Header
                    this.DOM.notificationBell.addEventListener('click', () => {
                        this.DOM.notificationsDropdown.classList.toggle('hidden');
                        this.DOM.notificationIndicator.classList.add('hidden');
                    });
                     document.getElementById('menu-toggle-button')?.addEventListener('click', () => this.DOM.sidebar?.classList.toggle('translate-x-full'));
                     document.addEventListener('click', (event) => {
                        if (this.DOM.notificationBell && !this.DOM.notificationBell.contains(event.target) && this.DOM.notificationsDropdown && !this.DOM.notificationsDropdown.contains(event.target)) {
                            this.DOM.notificationsDropdown.classList.add('hidden');
                        }
                    });

                    // Main content event delegation
                    this.DOM.mainContent.addEventListener('click', e => {
                        const delegatedTarget = e.target.closest('.summary-card, .nav-link-card, .functional-card, .breadcrumb-btn, .folder-item, .file-item, .add-folder-btn, .add-model-file-btn, .delete-item-btn, .back-to-suppliers-list, .back-to-database-specs, #add-new-sample-btn, .edit-sample-btn, .delete-sample-btn, .staged-project-accordion-toggle, #add-staged-project-btn, .add-staged-doc-btn, .remove-staged-project-btn, .update-project-status-btn, .tender-project-btn');

                        if (!delegatedTarget) return;

                        if (delegatedTarget.classList.contains('summary-card')) {
                            this.handlers.handleSummaryCardClick(delegatedTarget.dataset.status);
                            return;
                        }
                        if (delegatedTarget.classList.contains('nav-link-card')) {
                            e.preventDefault();
                            this.UI.showPage(delegatedTarget.dataset.page);
                            return;
                        }
                        if (delegatedTarget.matches('.breadcrumb-btn, .folder-item, .file-item, .add-folder-btn, .add-model-file-btn, .delete-item-btn')) {
                            this.handlers.handleFolderViewerInteraction({ currentTarget: delegatedTarget, stopPropagation: () => e.stopPropagation() });
                            return;
                        }
                        if (delegatedTarget.matches('.back-to-suppliers-list')) {
                            this.UI.showPage('suppliers-page');
                            return;
                        }
                        if (delegatedTarget.matches('.back-to-database-specs')) {
                            this.UI.showPage('database-specs-sub');
                            return;
                        }
                        if (delegatedTarget.matches('#add-new-sample-btn')) {
                            this.handlers.openSampleModal();
                            return;
                        }
                        if (delegatedTarget.matches('.edit-sample-btn')) {
                            this.handlers.openSampleModal(delegatedTarget.dataset.id);
                            return;
                        }
                        if (delegatedTarget.matches('.delete-sample-btn')) {
                            this.handlers.handleDeleteSample(delegatedTarget.dataset.id);
                            return;
                        }
                        if (delegatedTarget.classList.contains('staged-project-accordion-toggle')) {
                            const content = delegatedTarget.nextElementSibling;
                            const arrow = delegatedTarget.querySelector('svg');
                            content.classList.toggle('hidden');
                            arrow.classList.toggle('rotate-180');
                            return;
                        }
                        if (delegatedTarget.matches('#add-staged-project-btn')) {
                            this.handlers.openAddStagedProjectModal();
                            return;
                        }
                        if (delegatedTarget.matches('.add-staged-doc-btn')) {
                            const projectId = delegatedTarget.dataset.projectId;
                            const docType = delegatedTarget.dataset.docType;
                            this.UI.openAddFileModal({ destination: 'stagedProject', projectId, docType });
                            return;
                        }
                        if (delegatedTarget.matches('.remove-staged-project-btn')) {
                            this.handlers.handleRemoveStagedProject(delegatedTarget.dataset.id);
                            return;
                        }
                        if (delegatedTarget.matches('.update-project-status-btn')) {
                            this.handlers.handleUpdateProjectStatus(delegatedTarget.dataset.id, delegatedTarget.dataset.status);
                            return;
                        }
                        if (delegatedTarget.matches('.tender-project-btn')) {
                            this.handlers.handleTenderProject(delegatedTarget.dataset.id);
                            return;
                        }

                        if (delegatedTarget.classList.contains('functional-card')) {
                            const pageId = delegatedTarget.id.replace('show-', '');
                            this.UI.showPage(pageId);
                            return;
                        }
                    });

                    // Close modals
                    document.body.addEventListener('click', e => {
                        if (e.target.classList.contains('close-modal') || e.target.id === 'cancelDeleteBtn') {
                           e.target.closest('.modal-backdrop')?.classList.add('hidden');
                        }
                    });

                     // Form Submissions
                    document.getElementById('addFolderForm')?.addEventListener('submit', this.handlers.handleAddFolderSubmit.bind(this.handlers));
                    document.getElementById('addFileForm')?.addEventListener('submit', this.handlers.handleAddFileSubmit.bind(this.handlers));
                    document.getElementById('addSampleForm')?.addEventListener('submit', this.handlers.handleSampleFormSubmit.bind(this.handlers));

                    // Modal Buttons
                    document.getElementById('confirm-add-staged-project')?.addEventListener('click', () => {
                        const selectedCheckboxes = document.querySelectorAll('#staged-project-selection-list input[type="checkbox"]:checked');
                        if (selectedCheckboxes.length === 0) {
                            App.UI.showMessageModal('ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø´Ø±ÙˆØ¹ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.', 'âš ï¸', 'bg-yellow-100');
                            return;
                        }

                        selectedCheckboxes.forEach(checkbox => {
                            const projectId = parseInt(checkbox.dataset.projectId);
                            const project = App.DB.projects.find(p => p.id === projectId);
                            if (project && !App.DB.stagedProjects.some(p => p.id === projectId)) {
                                const newStagedProject = {
                                    id: project.id,
                                    name: project.name,
                                    type: project.type,
                                    region: project.region,
                                    status: 'proposed', // Initial status
                                    docs: { karrasa: [], mokhatat: [], jadwal: [], wathiqa: [] }
                                };
                                App.DB.stagedProjects.push(newStagedProject);
                                App.DB.logActivity('Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹', project.name, 'Ø¥Ø¶Ø§ÙØ© Ù„Ù„ØªØ­Ø¶ÙŠØ±', 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ù„Ù„Ø·Ø±Ø­');
                            }
                        });

                        document.getElementById('addStagedProjectModal').classList.add('hidden');
                        App.UI.renderStagedProjects();
                    });
                }
            };

            // This script handles all the interactivity of the project management portal.
            
            const loginPage = document.getElementById('login-page');
            const portalPage = document.getElementById('portal-page');
            const loginForm = document.getElementById('login-form');
            
            loginForm?.addEventListener('submit', e => {
                e.preventDefault();
                loginPage?.classList.add('hidden');
                portalPage?.classList.remove('hidden');
                App.init();
            });

            // Kickstart the application
            // In a real scenario, you'd call this after successful login.
            // For now, it's called from the form submit handler.
            window.App = App; // Make it globally accessible for simplicity in this single-file setup
        });
    </script>
</body>
</html>
